(function(){var j=false;var p=false;var g=false;var e=false;var n=[];$(document).ready(function(){$(".window, .window *").on("click",function(t){if(i($(this).closest(".window"))){t.preventDefault();t.stopPropagation()}});$(".window, .window *").on("mousedown",function(t){if(i($(this).closest(".window"))){a($(".window[data-modal-parent="+$(this).closest(".window").attr("id")+"]"));t.preventDefault();t.stopPropagation()}});h();$(".window .btn-container.x-btn").on("click",function(t){if($(this).hasClass("disabled")){return}q($(this).closest(".window"))});$(".menu-item").on("mouseenter",function(t){$(this).addClass("selected")});$(".menu-item").on("mouseleave",function(t){$(this).removeClass("selected")});$(".menu, .menu *").on("mousedown",function(t){g=true});$(".menu-item:not(.disabled)").on("click",function(t){c()});$(".menu-btn").on("mousedown",function(v){if($(this).closest(".window").hasClass("modal-frozen")){return}var u=$(this);if(v.which==1){var t=true;if(p){if($(this).hasClass("active")){t=false}c()}if(t){d(u)}}});$(".menu-btn").on("mouseenter",function(u){if(p&&!$(this).hasClass("active")){var t=$(this);c();d(t,true)}});$(":not(.menu-btn, .menu-btn *, .menu, .menu *)").on("mousedown",function(t){if(p&&!g){c()}if($(this).is("html")){g=false}});$(".window").on("mousedown",function(t){e=true;l($(this))});$("body").on("mousedown",function(t){if(!e){$(".window").removeClass("focused")}e=false});$(".btns .btn-container").on("mousedown",function(t){if(!$(this).hasClass("active")){$(this).closest(".btns").find(".active").removeClass("active");$(this).closest(".btn-container").addClass("active")}})});function d(v,t){if(!p){v.addClass("active");p=true;g=!t;var u=v.closest(".menu-bar").find(".menu#mnu_"+v.attr("id"));u.css("top",(v.height()+4)+"px");u.css("left",v.position().left+"px");u.css("display","inline-block")}}function c(){if(p){p=false;$(".menu-btn").removeClass("active");$(".menu").css("display","none")}g=false}function l(t){if(!t.hasClass("focused")){if(i(t)){return}$(".window").removeClass("focused");t.addClass("focused");o(t.attr("id"))}}function o(v){var t=n.indexOf(v);if(t==0){return}if(t!=-1){n.splice(t,1)}var u=$("#"+v).data("modal-parent");if(u){o(u)}n.unshift(v);s()}function k(u){var t=n.indexOf(u);if(t!=-1){n.splice(t,1);s()}}function s(){for(var t=0;t<n.length;t++){$("#"+n[t]).css("z-index",(n.length-t)*500)}}function h(){var t=$(".title-bar *:not(.window-btns, .window-btns *, .icon)");t.on("mousedown",function(y){if(i($(this).closest(".window"))){return}if(y.which==1){j=true;var x=$(this).closest(".window");var w=x.offset();var v=y.pageX-w.left;var u=y.pageY-w.top;$("body").on("mousemove",function(z){x.css("top",(z.pageY-u)+"px");x.css("left",(z.pageX-v)+"px")})}});$("body").on("mouseup",function(u){if(j){if(u.which==1){$("body").off("mousemove");j=false}}})}function b(u,w,v,t){if(u.hasClass("window")&&!u.hasClass("open")){if(typeof w!=="undefined"&&typeof v!=="undefined"){u.css("left",w+"px")}if(typeof v!=="undefined"){u.css("top",v+"px")}if(t&&t.length&&t.hasClass("window")){t.addClass("modal-frozen");u.addClass("modal");u.attr("data-modal-parent",t.attr("id"))}l(u);u.addClass("open")}}function q(u){if(u.hasClass("window")&&u.hasClass("open")&&!i(u)){u.removeClass("open active focused");u.find(".btn-container.active").removeClass("active");u.find(".btn-container.default").addClass("active");if(u.hasClass("modal")){var t=u.data("modal-parent")||false;if(t!==false){$("#"+t).removeClass("modal-frozen");l($("#"+t));u.attr("data-modal-parent","")}u.removeClass("modal")}else{k(u.attr("id"));l(n[0])}}}function i(u){var t=false;$(".window.modal.open").each(function(){if($(this).data("modal-parent")==u.attr("id")){t=true;return}});return t}function a(t){if(t.hasClass("focused")){r(t,70,3)}else{l(t)}}function m(t){r(t,500,0)}function r(v,t,u){if(!v.hasClass("window")||!v.hasClass("open")){return}if(v.data("is-blinking")){f(v)}v.data("blinks-completed",0);v.data("is-blinking",true);v.data("blink-timer",window.setInterval(function(z,y){if(!z.length){f(z);return}var w=z.data("blinks-completed")+1;z.data("blinks-completed",w);var x=z.find(".title-bar").first();if(w%2!=0){x.addClass("blinking")}else{x.removeClass("blinking")}if(y!=0&&z.data("blinks-completed")==y*2){f(z)}},t,v,u||0))}function f(t){if(!t.length||typeof t.data("blink-timer")=="undefined"){return}window.clearInterval(t.data("blink-timer"));t.data("is-blinking",false);t.removeClass("blinking")}window.SweeperOSEnvironment={showWindow:b,closeWindow:q,blinkWindow:m}})();