(function(){var k=false;var r=false;var h=false;var f=false;var p=[];var n=[0,0];var u=0;var b=null;$(document).ready(function(){$(window).on("resize",function(){if(b===null){b=window.setTimeout(function(){var x=$("#desktop").width()-100;var w=$("#desktop").height()-50;$(".window").each(function(){if($(this).offset().left>x){$(this).css("left",x)}if($(this).offset().top>w){$(this).css("top",w)}});window.clearTimeout(b);b=null},500)}});$(".window, .window *").on("click",function(w){if(j($(this).closest(".window"))){w.preventDefault();w.stopPropagation()}});$(".window, .window *").on("mousedown",function(w){if(j($(this).closest(".window"))){a($(".window[data-modal-parent="+$(this).closest(".window").attr("id")+"]"));w.preventDefault();w.stopPropagation()}});i();$(".window .btn-container.x-btn").on("click",function(){if($(this).hasClass("disabled")){return}s($(this).closest(".window"))});$(".menu-item").on("mouseenter",function(){$(this).addClass("selected")});$(".menu-item").on("mouseleave",function(){$(this).removeClass("selected")});$(".menu, .menu *").on("mousedown",function(){h=true});$(".menu-item:not(.disabled)").on("click",function(){d()});$(".menu-btn").on("mousedown",function(y){if($(this).closest(".window").hasClass("modal-frozen")){return}var x=$(this);if(y.which===1){var w=true;if(r){if($(this).hasClass("active")){w=false}d()}if(w){e(x)}}});$(".menu-btn").on("mouseenter",function(){if(r&&!$(this).hasClass("active")){var w=$(this);d();e(w,true)}});$(":not(.menu-btn, .menu-btn *, .menu, .menu *)").on("mousedown",function(){if(r&&!h){d()}if($(this).is("html")){h=false}});$(".window").on("mousedown",function(){f=true;m($(this))});$("body").on("mousedown",function(){if(!f){$(".window").removeClass("focused")}f=false});$(".btns .btn-container").on("mousedown",function(){if(!$(this).hasClass("active")){$(this).closest(".btns").find(".active").removeClass("active");$(this).closest(".btn-container").addClass("active")}})});function i(){var w=$(".title-bar *:not(.window-btns, .window-btns *, .icon)");w.on("mousedown",function(B){if(j($(this).closest(".window"))){return}if(B.which===1){k=true;var A=$(this).closest(".window");var z=A.offset();var y=B.pageX-z.left;var x=B.pageY-z.top;$("body").on("mousemove",function(){A.css("top",(B.pageY-x)+"px");A.css("left",(B.pageX-y)+"px")})}});$("body").on("mouseup",function(x){if(k){if(x.which===1){$("body").off("mousemove");k=false}}})}function e(y,w){if(!r){y.addClass("active");r=true;h=!w;var x=y.closest(".menu-bar").find(".menu#mnu_"+y.attr("id"));x.css("top",(y.height()+4)+"px");x.css("left",y.position().left+"px");x.css("display","inline-block")}}function d(){if(r){r=false;$(".menu-btn").removeClass("active");$(".menu").css("display","none")}h=false}function m(w){if(!w.hasClass("focused")){if(j(w)){return}$(".window").removeClass("focused");w.addClass("focused");q(w.attr("id"))}}function q(y){var w=p.indexOf(y);if(w===0){return}if(w!==-1){p.splice(w,1)}var x=$("#"+y).data("modal-parent");if(x){q(x)}p.unshift(y);v()}function l(x){var w=p.indexOf(x);if(w!==-1){p.splice(w,1);v()}}function v(){for(var w=0;w<p.length;w++){$("#"+p[w]).css("z-index",(p.length-w)*500)}}function c(z,B,A,y){if(z.hasClass("window")&&!z.hasClass("open")){if(typeof B!=="undefined"&&typeof A!=="undefined"){z.css("left",B+"px");z.css("top",A+"px")}else{z.css("left",n[0]+"px");z.css("top",n[1]+"px");n[0]+=22;n[1]+=22;var x=$("#desktop").width()-100;var w=$("#desktop").height()-50;if(n[0]>x||n[1]>w){u=(u+60>x?0:u+60);n[0]=u;n[1]=0}}if(y&&y.length&&y.hasClass("window")){y.addClass("modal-frozen");z.addClass("modal");z.attr("data-modal-parent",y.attr("id"))}m(z);z.addClass("open")}}function s(x){if(x.hasClass("window")&&x.hasClass("open")&&!j(x)){x.removeClass("open active focused");x.find(".btn-container.active").removeClass("active");x.find(".btn-container.default").addClass("active");if(x.hasClass("modal")){var w=x.data("modal-parent")||false;if(w!==false){$("#"+w).removeClass("modal-frozen");m($("#"+w));x.attr("data-modal-parent","")}x.removeClass("modal")}else{l(x.attr("id"));m(p[0])}}}function a(w){if(w.hasClass("focused")){t(w,70,3)}else{m(w)}}function o(w){t(w,500,0)}function t(y,w,x){if(!y.hasClass("window")||!y.hasClass("open")){return}if(y.data("is-blinking")){g(y)}y.data("blinks-completed",0);y.data("is-blinking",true);y.data("blink-timer",window.setInterval(function(C,B){if(!C.length){g(C);return}var z=C.data("blinks-completed")+1;C.data("blinks-completed",z);var A=C.find(".title-bar").first();if(z%2!==0){A.addClass("blinking")}else{A.removeClass("blinking")}if(B!==0&&C.data("blinks-completed")===B*2){g(C)}},w,y,x||0))}function g(w){if(!w.length||typeof w.data("blink-timer")==="undefined"){return}window.clearInterval(w.data("blink-timer"));w.data("is-blinking",false);w.removeClass("blinking")}window.SweeperOSEnvironment={showWindow:c,closeWindow:s,blinkWindow:o};function j(x){var w=false;$(".window.modal.open").each(function(){if($(this).data("modal-parent")===x.attr("id")){w=true;return}});return w}})();