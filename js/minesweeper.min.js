(function(){if(typeof window.SweeperOSEnvironment=="undefined"){console.log("Sweeper OS envrionment is unavailable. Minesweeper cannot run.");return}var D=window.SweeperOSEnvironment;var K=null;var T=0;var q=true;var C=true;var H=true;var g=false;var ac=false;var p=0;var c=0;var M=0;var u=0;var G=0;var R=null;var ap=0;var N=false;var k=false;var U=true;var w=false;var A=true;var au=false;var aC=9;var Z=9;var aw=10;var h=true;var r=false;var x=[["Anonymous",999],["Anonymous",999],["Anonymous",999]];function an(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(aE){$(".smiley-icon").removeClass("active");N=false;k=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(aE){if($(".window#ms-main").hasClass("focused")){if(aE.which==113){aE.preventDefault();J(M)}else{if(aE.which==112){aE.preventDefault();L()}else{if(aE.which==27){if(r){q=false}}}}return}if($(".window#ms-custom-board").hasClass("focused")){if(aE.which==27){al()}else{if(aE.which==13){if($(".cst-form input").is(":focus")){z()}else{$("#ms-custom-board .btns .btn-container.active").click()}}}return}if($(".window#ms-high-score").hasClass("focused")){if(aE.which==27||aE.which==13){y()}return}if($(".window#ms-leaderboard").hasClass("focused")){if(aE.which==27){X()}else{if(aE.which==13){$(this).find("#ms-leaderboard .btns .btn-container.active").click()}}return}if($(".window#ms-about").hasClass("focused")){if(aE.which==27||aE.which==13){Q()}return}if($(".window#ms-help").hasClass("focused")){if(aE.which==27||aE.which==13){B()}return}});$(".minesweeper").off("mousedown").on("mousedown",function(aE){if($(this).closest(".window").hasClass("modal-frozen")){return}if(!g&&(aE.which==1||aE.which==2)){$(".smiley-icon").addClass("active")}if(aE.which==2){r=true}});$(".minesweeper").off("mouseup").on("mouseup",function(aE){r=false});$(".smiley-btn").off("click").on("click",function(aE){J(M)});$("#game_new").on("click",function(aE){J(M)});$("#game_beg:not(.disabled)").on("click",function(aE){aA(0)});$("#game_int:not(.disabled)").on("click",function(aE){aA(1)});$("#game_exp:not(.disabled)").on("click",function(aE){aA(2)});$("#game_cst:not(.disabled)").on("click",function(aF){var aE=$(".minesweeper").offset();$("#ms-custom-board #cst-height").val(Z);$("#ms-custom-board #cst-width").val(aC);$("#ms-custom-board #cst-mines").val(aw);D.showWindow($("#ms-custom-board"),aE.left,aE.top,$("#ms-main"))});$("#game_mrk:not(.disabled)").on("click",function(aE){s(!U)});$("#game_snd:not(.disabled)").on("click",function(aE){ax(!w)});$("#game_clr:not(.disabled)").on("click",function(aE){d(!A)});$("#game_ldr:not(.disabled)").on("click",function(aE){ab()});$("#help_abt:not(.disabled)").on("click",function(aE){ae()});$("#help_play:not(.disabled)").on("click",function(aE){L()});$("#cst_ok").on("click",z);$("#cst_cancel").on("click",al);$("#hs_ok").on("click",y);$("#leader_ok").on("click",X);$("#leader_reset").on("click",P);$("#about_ok").on("click",Q);$("#help_ok").on("click",B);W()});function W(){$("body").addClass("loading");var aH=["about_header.gif","sprite.gif","spritebw.gif","bw_bg.gif","cursor_default.gif","cursor_pointer.gif"];var aF=[];var aG=function(aI,aK){var aJ=new Image();aJ.onload=function(){aK.resolve()};aJ.src=aI};for(var aE=0;aE<aH.length;aE++){aF[aE]=$.Deferred();aG("img/"+aH[aE],aF[aE])}$.when.apply($,aF).done(function(){$("body").removeClass("loading");J(0)})}function z(){var aG=$("#cst-width").val();var aF=$("#cst-height").val();var aE=$("#cst-mines").val();f(aG,aF,aE);aA(3);D.closeWindow($("#ms-custom-board"))}function al(){J(M);D.closeWindow($("#ms-custom-board"))}function y(){am(M,$("#ms-high-score #hs-name").val(),T);D.closeWindow($("#ms-high-score"));ab()}function X(){D.closeWindow($("#ms-leaderboard"))}function ab(){var aF=$(".minesweeper").offset();var aE=$(".ms-status").offset().top+$(".ms-status").outerHeight();D.showWindow($("#ms-leaderboard"),aF.left,aE,$("#ms-main"))}function ae(){var aE=$(".minesweeper").offset();D.showWindow($("#ms-about"),aE.left+30,aE.top+33,$("#ms-main"))}function Q(){D.closeWindow($("#ms-about"))}function L(){var aE=$(".minesweeper").offset();D.showWindow($("#ms-help"),aE.left+30,aE.top+33,$("#ms-main"))}function B(){$("#ms-help .help-content-inner").scrollTop(0);D.closeWindow($("#ms-help"))}function ax(aE,aF){if(aE==true){w=true;$("#game_snd").addClass("checked")}else{w=false;$("#game_snd").removeClass("checked")}if(!aF){l("snd",w)}}function s(aE,aF){if(aE==true){U=true;$("#game_mrk").addClass("checked")}else{U=false;$("#game_mrk").removeClass("checked")}if(!aF){l("mrk",U)}}function d(aE,aF){if(aE==true){A=true;$("#game_clr").addClass("checked");$(".minesweeper").removeClass("no-color")}else{A=false;$("#game_clr").removeClass("checked");$(".minesweeper").addClass("no-color")}if(!aF){l("clr",A)}}function aA(aI,aH){if(aI<0||aI>3){return}if(aI!=3){aC=9;Z=9;aw=10;au=false}var aE=["beg","int","exp","cst"];for(var aG=0;aG<aE.length;aG++){var aF=$("#game_"+aE[aG]);if(aG==aI){aF.addClass("checked")}else{aF.removeClass("checked")}}if(!aH){l("lvl",aI)}J(aI)}function f(aH,aE,aI,aG){if(!/^\d*$/.test(aH)){aH=9}aH=(aH>30?30:aH);aH=(aH<9?9:aH);if(!/^\d*$/.test(aE)){aE=9}aE=(aE>24?24:aE);aE=(aE<9?9:aE);if(!/^\d*$/.test(aI)){aI=10}aI=(aI<10?10:aI);var aF=(aE-1)*(aH-1);aI=(aI>aF?aF:aI);au=true;aC=aH;Z=aE;aw=aI;if(!aG){l("board_width",aH);l("board_height",aE);l("board_mines",aI)}}function az(){$(".window *").off("contextmenu").on("contextmenu",function(aE){aE.preventDefault()});$(".minesweeper .ms-panel").off("mousedown").on("mousedown",function(aF){if($(this).closest(".window").hasClass("modal-frozen")){return}if(!g){switch(aF.which){case 1:N=true;$(this).trigger("mouseenter");break;case 2:k=true;$(this).trigger("mouseenter");break;case 3:var aE=$(this);b(aE,aF);break}}});$(".minesweeper .ms-panel").off("mouseenter").on("mouseenter",function(aI){if(N&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(k){var aH=af($(this));var aG=j(aH[0],aH[1]);for(var aF=aG[0][0];aF<=aG[0][1];aF++){for(var aE=aG[1][0];aE<=aG[1][1];aE++){if(!O(aF,aE)){$('.ms-panel[data-coord="'+aF+","+aE+'"]').addClass("down")}}}}}});$(".minesweeper .ms-panel").off("mouseleave").on("mouseleave",function(aE){if((N||k)&&(aE.which==1||aE.which==2)){$(".ms-panel.down").removeClass("down")}});$(".minesweeper .ms-panel").off("mouseup").on("mouseup",function(aF){if((N||k)&&!g){if(C){o()}var aE=$(this);b(aE,aF)}})}function b(aN,aO){if(!aN.length||!aN.hasClass("ms-panel")){return}var aL=af(aN);var aQ=aL[0];var aF=aL[1];if(aO.which==1){$(".smiley-icon").removeClass("active");N=false;if(!g){if(!ar(aQ,aF)){aj(aQ,aF)}}}if(aO.which==2&&I(aQ,aF)&&ar(aQ,aF)){var aE=j(aQ,aF);var aG=[];var aM=aa(aQ,aF);for(var aJ=aE[0][0];aJ<=aE[0][1];aJ++){for(var aI=aE[1][0];aI<=aE[1][1];aI++){if(aJ==aQ&&aI==aF){continue}if(O(aJ,aI)){aM--}else{aG.push([aJ,aI])}}}if(aM!==0){return}var aH=aG.length;for(var aJ=0;aJ<aH;aJ++){var aK=aG[aJ][0];var aP=aG[aJ][1];if(e(aK,aP)){aG.splice(aJ,1);aG.push([aK,aP]);aH--;aJ--}}for(var aJ=0;aJ<aG.length;aJ++){var aK=aG[aJ][0];var aP=aG[aJ][1];aj(aK,aP)}}else{if(aO.which==3){if(!g&&!ar(aQ,aF)){if(!O(aQ,aF)&&!ay(aQ,aF)){aD(aQ,aF);V()}else{if(U&&O(aQ,aF)){ai(aQ,aF);ak()}else{if(!U){ak()}ad(aQ,aF)}}}}}}function af(aF){var aE=aF.data("coord").split(",");return[parseInt(aE[0],10),parseInt(aE[1],10)]}function aD(aG,aE){var aF=R[aG][aE];if(!g&&!aF.triggered&&!aF.marked){R[aG][aE].flagged=true}ag(aG,aE)}function ai(aG,aE){var aF=R[aG][aE];if(!g&&!aF.triggered&&aF.flagged){aF.flagged=false;aF.marked=true}R[aG][aE]=aF;ag(aG,aE)}function ad(aG,aE){var aF=R[aG][aE];if(!g&&!aF.triggered){aF.marked=false;aF.flagged=false}R[aG][aE]=aF;ag(aG,aE)}function aj(aG,aE){var aF=R[aG][aE];if(g||aF.triggered||aF.flagged){return}aF.triggered=true;R[aG][aE]=aF;if(!H&&aF.isMine){m(aG,aE);return}else{if(H&&aF.isMine){R[aG][aE].isMine=false;E(aG,aE,true);F(aG,aE)}}ag(aG,aE);if(aF.number==0&&!aF.isMine&&!aF.flagged){aB(aG,aE)}if(--ap==0){a()}H=false}function aB(aM,aF){var aE=(aM==0)?0:aM-1;var aL=(aM==G-1)?G-1:aM+1;var aJ=(aF==0)?0:aF-1;var aG=(aF==u-1)?u-1:aF+1;for(var aI=aE;aI<=aL;aI++){for(var aH=aJ;aH<=aG;aH++){var aK=R[aI][aH];if(aK.number>0||(!aK.isMine&&!aK.flagged)){aj(aI,aH)}}}}function n(aF,aE){R[aF][aE].isMine=true}function m(aF,aE){var aH=R[aF][aE];if(!aH.isMine){return}aH.exploded=true;R[aF][aE]=aH;if(w){document.getElementById("snd_explode").play()}ao();for(var aF=0;aF<G;aF++){for(var aE=0;aE<u;aE++){var aG=R[aF][aE];var aI=false;if(!aG.flagged&&aG.isMine){aI=true}else{if(!aG.isMine&&aG.flagged){aI=true;aG.number=0}}if(aI){aG.triggered=true;R[aF][aE]=aG;ag(aF,aE)}}}$(".smiley-icon").addClass("dead")}function ar(aF,aE){return R[aF][aE].triggered}function av(aF,aE){var aG=R[aF][aE];return !aG.triggered&&!aG.marked&&!aG.flagged}function I(aF,aE){return R[aF][aE].number!=0}function ay(aF,aE){return R[aF][aE].marked}function O(aF,aE){return R[aF][aE].flagged}function e(aF,aE){return R[aF][aE].isMine}function aa(aF,aE){return R[aF][aE].number}function ag(aF,aE){var aH=$('.ms-panel[data-coord="'+aF+","+aE+'"]');var aG=R[aF][aE];aH.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(aG.triggered){aH.addClass("triggered");if(aG.number>0){aH.addClass("m"+aG.number)}if(aG.isMine){aH.addClass("mine")}if(aG.exploded){aH.addClass("exploded")}if(!aG.isMine&&aG.flagged){aH.addClass("bogus")}}else{if(aG.flagged){aH.addClass("flagged")}if(aG.marked){aH.addClass("marked")}}}function aq(){Y();K=setInterval(function(){Y()},1000)}function t(){clearInterval(K)}function Y(){if(q){if(T<999){T++;i("time",T);if(w){document.getElementById("snd_tick").play()}}}}function ak(){if(p<c){p++;i("mines",p)}}function V(){if(p>-99){p--;i("mines",(p>-100)?p:-99)}}function i(aH,aG){aH=".num-box#"+aH;num=Math.abs(aG);var aF=Math.floor(num/100);num-=aF*100;var aE=Math.floor(num/10);num-=aE*10;if(aG<0){aF="n"}$(aH+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(aH+" .digit.iii").addClass("d"+aF);$(aH+" .digit.ii").addClass("d"+aE);$(aH+" .digit.i").addClass("d"+num)}function J(aP){ao();C=true;g=false;H=true;q=true;if(aP<0||aP>3||(aP==3&&!au)){aP=0}var aJ={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(aP!=3){var aH=aJ.width[aP];var aS=aJ.height[aP];var aR=aJ.mines[aP]}else{var aH=aC;var aS=Z;var aR=aw}c=aR;p=aR;u=aH;G=aS;M=aP;ac=false;T=0;R=[];ap=(aH*aS)-aR;if(h){h=false;var aN=v("leaderboard");var aL=x;try{if(aN!=null){aL=$.parseJSON(aN)}}catch(aM){console.log("Error: leaderboard data is corrupt. Resetting to default...");l("leaderboard",JSON.stringify(x))}for(var aG=0;aG<3;aG++){am(aG,aL[aG][0],aL[aG][1],true)}var aQ=v("snd");aQ=(aQ=="true")?true:false;ax(aQ,true);var aF=v("mrk");aF=(aF=="true"||aF==null)?true:false;s(aF,true);var aI=v("clr");aI=(aI=="true"||aI==null)?true:false;d(aI,true);var aO=v("lvl");var aE=v("board_width");var aK=v("board_height");var aT=v("board_mines");if(aO!==null){if(aO!=3||(aE!==null&&aK!=null&&aT!=null)){if(aO==3){f(aE,aK,aT,true)}aA(aO,true);return}}}ah();i("time",T);i("mines",p);$(".smiley-icon").removeClass("active cool dead");az();D.showWindow($("#ms-main"),40,40)}function ah(){var aH="";for(var aG=0;aG<G;aG++){R.push([]);aH+="<div class='ms-row'>";for(var aF=0;aF<u;aF++){R[aG].push(new an());aH+="<div class='ms-panel' data-coord='"+aG+","+aF+"'></div>"}aH+="</div>"}var aE=c;while(aE--){F()}$(".ms-grid").html(aH)}function F(aF,aH){var aJ=typeof aF!="undefined";var aI=-1;var aE=-1;var aG=null;do{aI=at(0,G-1);aE=at(0,u-1);aG=R[aI][aE]}while(aG.isMine||(aJ&&aI==aF&&aE==aH));R[aI][aE].number=0;n(aI,aE);E(aI,aE)}function E(aK,aH,aF){var aJ=j(aK,aH);var aE=0;for(var aI=aJ[0][0];aI<=aJ[0][1];aI++){for(var aG=aJ[1][0];aG<=aJ[1][1];aG++){if(e(aI,aG)){aE++;continue}if((aK==aI&&aH==aG)){continue}if(!aF){R[aI][aG].number++}else{R[aI][aG].number--}}}if(aF){R[aK][aH].number=aE}}function at(aF,aE){return Math.floor(Math.random()*(aE+1-aF))+aF}function j(aI,aG){var aH=(aI==0)?0:aI-1;var aJ=(aI==G-1)?G-1:aI+1;var aE=(aG==0)?0:aG-1;var aF=(aG==u-1)?u-1:aG+1;return[[aH,aJ],[aE,aF]]}function S(){return !C&&!g}function o(){if(C){C=false;g=false;aq()}}function ao(){g=true;t()}function a(){$(".smiley-icon").addClass("cool");if(w){document.getElementById("snd_win").play()}if(M<3&&M>=0){if(x[M][1]>T){var aG=["beginner","intermediate","expert"];var aE=$("#ms-high-score #hs-description");var aI=aE.data("hs-msg").replace("%LEVEL%",aG[M]);aE.html(aI);$("#ms-high-score #hs-name").val(x[M][0]);var aH=$(".minesweeper").offset();var aF=$(".ms-status").offset().top+$(".ms-status").outerHeight();D.showWindow($("#ms-high-score"),aH.left,aF,$("#ms-main"));$("#ms-high-score #hs-name").select()}}ao()}function am(aF,aG,aI,aH){if(aF<0||aF>2||aI<0||aI>999){return}aG=aG.substr(0,32);x[aF][0]=aG;x[aF][1]=aI;if(!aH){l("leaderboard",JSON.stringify(x))}var aJ=$("#ms-leaderboard .leader-container .row[data-leader-row="+aF+"]");var aE=$("#ms-leaderboard .leader-container").data("time-string").replace("%TIME%",aI);aJ.find(".time").first().html(aE);aJ.find(".name").first().html(aG)}function P(){for(var aE=0;aE<2;aE++){am(aE,"Anonymous",999)}}function v(aE){if(typeof window.localStorage!="undefined"){return window.localStorage.getItem(aE)}return null}function l(aE,aF){if(typeof window.localStorage!="undefined"){window.localStorage.setItem(aE,aF)}}})();