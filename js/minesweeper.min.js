(function(){var I=null;var X=0;var B=true;var j=true;var C=false;var w=false;var J=0;var Z=0;var k=0;var ae=0;var af=0;var Q=null;var G=0;var ad=false;var U=false;var T=true;var P=false;var d=false;var ag=0;var m=0;var o=0;var ac=true;var N=[["Anonymous",999],["Anonymous",999],["Anonymous",999]];function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(am){$(".smiley-icon").removeClass("active");ad=false;U=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(am){if($(".window#ms-main").hasClass("focused")){if(am.which==113){am.preventDefault();l(k)}else{if(am.which==112){am.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(am){if(!C&&(am.which==1||am.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(am){l(k)});$("#game_new").on("click",function(am){l(k)});$("#game_beg:not(.disabled)").on("click",function(am){p(0)});$("#game_int:not(.disabled)").on("click",function(am){p(1)});$("#game_exp:not(.disabled)").on("click",function(am){p(2)});$("#game_cst:not(.disabled)").on("click",function(am){u(16,10,15);p(3)});$("#game_mrk:not(.disabled)").on("click",function(am){D(!T)});$("#game_snd:not(.disabled)").on("click",function(am){z(!P)});l(0)});function z(an,am){if(an==true){P=true;$("#game_snd").addClass("checked")}else{P=false;$("#game_snd").removeClass("checked")}if(!am){n("SWEEP_SND",P?1:0,365)}}function D(an,am){if(an==true){T=true;$("#game_mrk").addClass("checked")}else{T=false;$("#game_mrk").removeClass("checked")}if(!am){n("SWEEP_MRK",T?1:0,365)}}function p(aq,am){if(aq<0||aq>3){return}var an=["beg","int","exp","cst"];for(var ap=0;ap<an.length;ap++){var ao=$("#game_"+an[ap]);if(ap==aq){ao.addClass("checked")}else{ao.removeClass("checked")}}if(!am){n("SWEEP_LVL",aq,365)}l(aq)}function u(ap,am,aq,ao){ap=(ap>30?30:ap);ap=(ap<9?9:ap);am=(am>24?24:am);am=(am<9?9:am);aq=(aq<10?10:aq);var an=(am-1)*(ap-1);aq=(aq>an?an:aq);d=true;ag=ap;m=am;o=aq;if(!ao){n("SWEEP_WIDTH",ap,365);n("SWEEP_HEIGHT",am,365);n("SWEEP_MINES",aq,365)}}function x(){$(".window *").off("contextmenu").on("contextmenu",function(am){am.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(an){if(!C){switch(an.which){case 1:ad=true;$(this).trigger("mouseenter");break;case 2:U=true;$(this).trigger("mouseenter");break;case 3:var am=$(this);Y(am,an);break}}});$(".ms-panel").off("mouseenter").on("mouseenter",function(aq){if(ad&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(U){var ap=W($(this));var ao=b(ap[0],ap[1]);for(var an=ao[0][0];an<=ao[0][1];an++){for(var am=ao[1][0];am<=ao[1][1];am++){if(!y(an,am)){$('.ms-panel[data-coord="'+an+","+am+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(am){if((ad||U)&&(am.which==1||am.which==2)){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(an){if((ad||U)&&!C){if(B){S()}var am=$(this);Y(am,an)}})}function Y(aw,ax){if(!aw.length||!aw.hasClass("ms-panel")){return}var au=W(aw);var az=au[0];var an=au[1];if(ax.which==1){$(".smiley-icon").removeClass("active");ad=false;if(!C){if(!ah(az,an)){K(az,an)}}}if(ax.which==2&&ak(az,an)&&ah(az,an)){var am=b(az,an);var ao=[];var av=F(az,an);for(var ar=am[0][0];ar<=am[0][1];ar++){for(var aq=am[1][0];aq<=am[1][1];aq++){if(ar==az&&aq==an){continue}if(y(ar,aq)){av--}else{ao.push([ar,aq])}}}if(av!==0){return}var ap=ao.length;for(var ar=0;ar<ap;ar++){var at=ao[ar][0];var ay=ao[ar][1];if(i(at,ay)){ao.splice(ar,1);ao.push([at,ay]);ap--;ar--}}for(var ar=0;ar<ao.length;ar++){var at=ao[ar][0];var ay=ao[ar][1];K(at,ay)}}else{if(ax.which==3){if(!C&&!ah(az,an)){if(!y(az,an)&&!e(az,an)){M(az,an);t()}else{if(T&&y(az,an)){g(az,an);al()}else{if(!T){al()}R(az,an)}}}}}}function W(an){var am=an.data("coord").split(",");return[parseInt(am[0],10),parseInt(am[1],10)]}function M(ao,am){var an=Q[ao][am];if(!C&&!an.triggered&&!an.marked){Q[ao][am].flagged=true}V(ao,am)}function g(ao,am){var an=Q[ao][am];if(!C&&!an.triggered&&an.flagged){an.flagged=false;an.marked=true}Q[ao][am]=an;V(ao,am)}function R(ao,am){var an=Q[ao][am];if(!C&&!an.triggered){an.marked=false;an.flagged=false}Q[ao][am]=an;V(ao,am)}function K(ao,am){var an=Q[ao][am];if(C||an.triggered||an.flagged){return}an.triggered=true;Q[ao][am]=an;if(!j&&an.isMine){r(ao,am);return}else{if(j&&an.isMine){Q[ao][am].isMine=false;aa(ao,am,true);s(ao,am)}}V(ao,am);if(an.number==0&&!an.isMine&&!an.flagged){E(ao,am)}if(--G==0){O()}j=false}function E(av,an){var am=(av==0)?0:av-1;var au=(av==af-1)?af-1:av+1;var ar=(an==0)?0:an-1;var ao=(an==ae-1)?ae-1:an+1;for(var aq=am;aq<=au;aq++){for(var ap=ar;ap<=ao;ap++){var at=Q[aq][ap];if(at.number>0||(!at.isMine&&!at.flagged)){K(aq,ap)}}}}function L(an,am){Q[an][am].isMine=true}function r(an,am){var ap=Q[an][am];if(!ap.isMine){return}ap.exploded=true;Q[an][am]=ap;if(P){document.getElementById("snd_explode").play()}ai();for(var an=0;an<af;an++){for(var am=0;am<ae;am++){var ao=Q[an][am];var aq=false;if(!ao.flagged&&ao.isMine){aq=true}else{if(!ao.isMine&&ao.flagged){aq=true;ao.number=0}}if(aq){ao.triggered=true;Q[an][am]=ao;V(an,am)}}}$(".smiley-icon").addClass("dead")}function ah(an,am){return Q[an][am].triggered}function c(an,am){var ao=Q[an][am];return !ao.triggered&&!ao.marked&&!ao.flagged}function ak(an,am){return Q[an][am].number!=0}function e(an,am){return Q[an][am].marked}function y(an,am){return Q[an][am].flagged}function i(an,am){return Q[an][am].isMine}function F(an,am){return Q[an][am].number}function V(an,am){var ap=$('.ms-panel[data-coord="'+an+","+am+'"]');var ao=Q[an][am];ap.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(ao.triggered){ap.addClass("triggered");if(ao.number>0){ap.addClass("m"+ao.number)}if(ao.isMine){ap.addClass("mine")}if(ao.exploded){ap.addClass("exploded")}if(!ao.isMine&&ao.flagged){ap.addClass("bogus")}}else{if(ao.flagged){ap.addClass("flagged")}if(ao.marked){ap.addClass("marked")}}}function q(){ab();I=setInterval(function(){ab()},1000)}function h(){clearInterval(I)}function ab(){if(X<999){X++;aj("time",X);if(P){document.getElementById("snd_tick").play()}}}function al(){if(J<Z){J++;aj("mines",J)}}function t(){if(J>-99){J--;aj("mines",(J>-100)?J:-99)}}function aj(ap,ao){ap=".num-box#"+ap;num=Math.abs(ao);var an=Math.floor(num/100);num-=an*100;var am=Math.floor(num/10);num-=am*10;if(ao<0){an="n"}$(ap+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(ap+" .digit.iii").addClass("d"+an);$(ap+" .digit.ii").addClass("d"+am);$(ap+" .digit.i").addClass("d"+num)}function l(av){ai();B=true;C=false;j=true;if(av<0||av>3||(av==3&&!d)){av=0}var ap={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(av!=3){var ao=ap.width[av];var ay=ap.height[av];var aw=ap.mines[av]}else{var ao=ag;var ay=m;var aw=o}Z=aw;J=aw;ae=ao;af=ay;k=av;w=false;X=0;Q=[];G=(ao*ay)-aw;if(ac){ac=false;var at=f("SWEEP_TOP");try{if(at!==""){N=$.parseJSON(at)}}catch(ar){console.log("Error: leaderboard data is corrupt. Resetting to default...");n("SWEEP_TOP",N,365)}var ax=f("SWEEP_SND");if(ax!==""){z(ax,true)}var an=f("SWEEP_MRK");if(an!==""){D(an,true)}var au=f("SWEEP_LVL");var am=f("SWEEP_WIDTH");var aq=f("SWEEP_HEIGHT");var az=f("SWEEP_MINES");if(au!==""){if(au!=3||(am!==""&&aq!==""&&az!=="")){if(au==3){u(am,aq,az,true)}p(au,true);return}}}A();aj("time",X);aj("mines",J);$(".smiley-icon").removeClass("active cool dead");x();$(".window#ms-main").css("display","inline-block")}function A(){var ap="";for(var ao=0;ao<af;ao++){Q.push([]);ap+="<div class='ms-row'>";for(var an=0;an<ae;an++){Q[ao].push(new a());ap+="<div class='ms-panel' data-coord='"+ao+","+an+"'></div>"}ap+="</div>"}var am=Z;while(am--){s()}$(".ms-grid").html(ap)}function s(an,ap){var ar=typeof an!="undefined";var aq=-1;var am=-1;var ao=null;do{aq=v(0,af-1);am=v(0,ae-1);ao=Q[aq][am]}while(ao.isMine||(ar&&aq==an&&am==ap));Q[aq][am].number=0;L(aq,am);aa(aq,am)}function aa(at,ap,an){var ar=b(at,ap);var am=0;for(var aq=ar[0][0];aq<=ar[0][1];aq++){for(var ao=ar[1][0];ao<=ar[1][1];ao++){if(i(aq,ao)){am++;continue}if((at==aq&&ap==ao)){continue}if(!an){Q[aq][ao].number++}else{Q[aq][ao].number--}}}if(an){Q[at][ap].number=am}}function v(an,am){return Math.floor(Math.random()*(am+1-an))+an}function b(aq,ao){var ap=(aq==0)?0:aq-1;var ar=(aq==af-1)?af-1:aq+1;var am=(ao==0)?0:ao-1;var an=(ao==ae-1)?ae-1:ao+1;return[[ap,ar],[am,an]]}function H(){return !B&&!C}function S(){if(B){B=false;C=false;q()}}function ai(){C=true;h()}function O(){$(".smiley-icon").addClass("cool");if(P){document.getElementById("snd_win").play()}if(k<3&&k>=0){if(N[k][1]<X){N[k][1]=X;n("SWEEP_TOP",JSON.stringify(N),365)}}ai()}function n(an,aq,ap){ap*=86400000;var ao=new Date(Date.now()+ap);var am="expires="+ao.toUTCString();document.cookie=an+"="+aq+"; "+am}function f(an){an=an+"=";var am=document.cookie.split(";");for(var ap=0;ap<am.length;ap++){var ao=am[ap];while(ao.charAt(0)==" "){ao=ao.substring(1)}if(ao.indexOf(an)==0){return ao.substring(an.length,ao.length)}}return""}})();