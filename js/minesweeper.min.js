(function(){var x=null;var I=0;var s=true;var g=true;var t=false;var o=false;var y=0;var K=0;var h=0;var O=0;var P=0;var D=null;var v=0;var N=false;function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(U){if(!t){$(".smiley-icon").removeClass("active");N=false}});$("body").on("keydown",function(U){if($(".window#ms-main").hasClass("focused")){if(U.which==113){U.preventDefault();i(h)}else{if(U.which==112){U.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(U){if(!t&&U.which==1){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(U){i(h)});$("#game_new").on("click",function(U){i(h)});$("#game_beg:not(.disabled)").on("click",function(U){i(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});$("#game_int:not(.disabled)").on("click",function(U){i(1);$("#game_beg").removeClass("checked");$("#game_int").addClass("checked");$("#game_exp").removeClass("checked")});$("#game_exp:not(.disabled)").on("click",function(U){i(2);$("#game_beg").removeClass("checked");$("#game_int").removeClass("checked");$("#game_exp").addClass("checked")});$("#game_cst:not(.disabled)").on("click",function(U){i(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});i(0)});function p(){$(".window *").off("contextmenu").on("contextmenu",function(U){U.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(V){if(V.which==1&&!t){N=true}else{if(V.which==3&&!t){var U=$(this);J(U,V)}}});$(".ms-panel").off("mousenter").on("mouseenter",function(U){if(N&&!$(this).hasClass("flagged")){$(this).addClass("down")}});$(".ms-panel").off("mouseleave").on("mouseleave",function(U){if(U.which==1&&!$(this).hasClass("triggered")){$(this).removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(V){if(N&&!t){if(s){F()}var U=$(this);J(U,V)}})}function J(W,V){V.stopPropagation();if(!W.length||!W.hasClass("ms-panel")){return}var Y=H(W);var X=Y[0];var U=Y[1];if(V.which==1){$(".smiley-icon").removeClass("active");N=false;if(!t){if(!Q(X,U)){z(X,U)}}}else{if(V.which==3){if(!t&&!Q(X,U)){if(!q(X,U)&&!c(X,U)){A(X,U);m()}else{if(q(X,U)){d(X,U);T()}else{E(X,U)}}}}}}function H(V){var U=V.data("coord").split(",");return[parseInt(U[0],10),parseInt(U[1],10)]}function A(W,U){var V=D[W][U];if(!t&&!V.triggered&&!V.marked){D[W][U].flagged=true}G(W,U)}function d(W,U){var V=D[W][U];if(!t&&!V.triggered&&V.flagged){V.flagged=false;V.marked=true}D[W][U]=V;G(W,U)}function E(W,U){var V=D[W][U];if(!t&&!V.triggered){V.marked=false;V.flagged=false}D[W][U]=V;G(W,U)}function z(W,U){var V=D[W][U];if(t||V.triggered||V.flagged){return}V.triggered=true;D[W][U]=V;if(!g&&V.isMine){k(W,U);return}else{if(g&&V.isMine){D[W][U].isMine=false;L(W,U,true);l(W,U)}}G(W,U);if(V.number==0&&!V.isMine&&!V.flagged){u(W,U)}if(--v==0){C()}g=false}function u(ac,V){var U=(ac==0)?0:ac-1;var ab=(ac==P-1)?P-1:ac+1;var Z=(V==0)?0:V-1;var W=(V==O-1)?O-1:V+1;for(var Y=U;Y<=ab;Y++){for(var X=Z;X<=W;X++){var aa=D[Y][X];if(aa.number>0||(!aa.isMine&&!aa.flagged)){z(Y,X)}}}}function B(V,U){D[V][U].isMine=true}function k(V,U){var X=D[V][U];if(!X.isMine){return}X.exploded=true;D[V][U]=X;R();for(var V=0;V<P;V++){for(var U=0;U<O;U++){var W=D[V][U];var Y=false;if(!W.flagged&&W.isMine){Y=true}else{if(!W.isMine&&W.flagged){Y=true;W.number=0}}if(Y){W.triggered=true;D[V][U]=W;G(V,U)}}}$(".smiley-icon").addClass("dead")}function Q(V,U){return D[V][U].triggered}function b(V,U){var W=D[V][U];return !W.triggered&&!W.marked&&!W.flagged}function c(V,U){return D[V][U].marked}function q(V,U){return D[V][U].flagged}function f(V,U){return D[V][U].isMine}function G(V,U){var X=$('.ms-panel[data-coord="'+V+","+U+'"]');var W=D[V][U];X.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(W.triggered){X.addClass("triggered");if(W.number>0){X.addClass("m"+W.number)}if(W.isMine){X.addClass("mine")}if(W.exploded){X.addClass("exploded")}if(!W.isMine&&W.flagged){X.addClass("bogus")}}else{if(W.flagged){X.addClass("flagged")}if(W.marked){X.addClass("marked")}}}function j(){I=1;S("time",I);x=setInterval(function(){M()},1000)}function e(){clearInterval(x)}function M(){if(I<999){I++;S("time",I)}}function T(){if(y<K){y++;S("mines",y)}}function m(){if(y>-99){y--;S("mines",(y>-100)?y:-99)}}function S(X,W){X=".num-box#"+X;num=Math.abs(W);var V=Math.floor(num/100);num-=V*100;var U=Math.floor(num/10);num-=U*10;if(W<0){V="n"}$(X+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(X+" .digit.iii").addClass("d"+V);$(X+" .digit.ii").addClass("d"+U);$(X+" .digit.i").addClass("d"+num)}function i(Y,V,U,W){R();s=true;t=false;g=true;var X={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(Y>=0||Y<=2){V=X.width[Y];U=X.height[Y];W=X.mines[Y]}K=W;y=W;O=V;P=U;h=Y;o=false;I=0;D=[];v=(V*U)-W;r();S("time",I);S("mines",y);$(".smiley-icon").removeClass("active cool dead");p();$(".window#ms-main").css("display","inline-block")}function r(){var X="";for(var W=0;W<P;W++){D.push([]);X+="<div class='ms-row'>";for(var V=0;V<O;V++){D[W].push(new a());X+="<div class='ms-panel' data-coord='"+W+","+V+"'></div>"}X+="</div>"}var U=K;while(U--){l()}$(".ms-grid").html(X)}function l(V,X){var Z=typeof V!="undefined";var Y=-1;var U=-1;var W=null;do{Y=n(0,P-1);U=n(0,O-1);W=D[Y][U]}while(W.isMine||(Z&&Y==V&&U==X));D[Y][U].number=0;B(Y,U);L(Y,U)}function L(ad,W,ab){var V=(ad==0)?0:ad-1;var ac=(ad==P-1)?P-1:ad+1;var aa=(W==0)?0:W-1;var X=(W==O-1)?O-1:W+1;var U=0;for(var Z=V;Z<=ac;Z++){for(var Y=aa;Y<=X;Y++){if(f(Z,Y)){U++;continue}if((ad==Z&&W==Y)){continue}if(!ab){D[Z][Y].number++}else{D[Z][Y].number--}}}if(ab){D[ad][W].number=U}}function n(V,U){return Math.floor(Math.random()*(U+1-V))+V}function w(){return !s&&!t}function F(){if(s){s=false;t=false;j()}}function R(){t=true;e()}function C(){$(".smiley-icon").addClass("cool");R()}})();