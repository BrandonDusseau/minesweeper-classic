(function(){var E=null;var T=0;var x=true;var i=true;var y=false;var s=false;var F=0;var V=0;var j=0;var aa=0;var ab=0;var M=null;var C=0;var Z=false;var Q=false;var P=true;var L=false;var Y=true;var J=null;function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(ah){$(".smiley-icon").removeClass("active");Z=false;Q=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(ah){if($(".window#ms-main").hasClass("focused")){if(ah.which==113){ah.preventDefault();k(j)}else{if(ah.which==112){ah.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(ah){if(!y&&(ah.which==1||ah.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(ah){k(j)});$("#game_new").on("click",function(ah){k(j)});$("#game_beg:not(.disabled)").on("click",function(ah){m(0)});$("#game_int:not(.disabled)").on("click",function(ah){m(1)});$("#game_exp:not(.disabled)").on("click",function(ah){m(2)});$("#game_cst:not(.disabled)").on("click",function(ah){m(3)});$("#game_mrk:not(.disabled)").on("click",function(ah){z(!P)});$("#game_snd:not(.disabled)").on("click",function(ah){v(!L)});k(0)});function v(ai,ah){if(ai==true){L=true;$("#game_snd").addClass("checked")}else{L=false;$("#game_snd").removeClass("checked")}if(!ah){l("SWEEP_SND",L?1:0,365)}}function z(ai,ah){if(ai==true){P=true;$("#game_mrk").addClass("checked")}else{P=false;$("#game_mrk").removeClass("checked")}if(!ah){l("SWEEP_MRK",P?1:0,365)}}function m(al,ah){if(al<0||al>2){return}j=al;k(j);var ai=["beg","int","exp","cst"];for(var ak=0;ak<ai.length;ak++){var aj=$("#game_"+ai[ak]);if(ak==al){aj.addClass("checked")}else{aj.removeClass("checked")}}if(!ah){l("SWEEP_LVL",j,365)}}function t(){$(".window *").off("contextmenu").on("contextmenu",function(ah){ah.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(ai){if(!y){switch(ai.which){case 1:Z=true;$(this).trigger("mouseenter");break;case 2:Q=true;$(this).trigger("mouseenter");break;case 3:var ah=$(this);U(ah,ai);break}}});$(".ms-panel").off("mousenter").on("mouseenter",function(al){if(Z&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(Q){var ak=S($(this));var aj=b(ak[0],ak[1]);for(var ai=aj[0][0];ai<=aj[0][1];ai++){for(var ah=aj[1][0];ah<=aj[1][1];ah++){if(!u(ai,ah)){$('.ms-panel[data-coord="'+ai+","+ah+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(ah){if(ah.which==1||ah.which==2){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(ai){if((Z||Q)&&!y){if(x){O()}var ah=$(this);U(ah,ai);$("body").trigger("mouseup")}})}function U(aq,ar){ar.stopPropagation();if(!aq.length||!aq.hasClass("ms-panel")){return}var ao=S(aq);var au=ao[0];var ai=ao[1];if(ar.which==1){$(".smiley-icon").removeClass("active");Z=false;if(!y){if(!ac(au,ai)){G(au,ai)}}}if(ar.which==2&&af(au,ai)&&ac(au,ai)){var ah=b(au,ai);var aj=[];var ap=B(au,ai);for(var am=ah[0][0];am<=ah[0][1];am++){for(var al=ah[1][0];al<=ah[1][1];al++){if(am==au&&al==ai){continue}if(u(am,al)){ap--}else{aj.push([am,al])}}}if(ap!==0){return}var ak=aj.length;for(var am=0;am<ak;am++){var an=aj[am][0];var at=aj[am][1];if(h(an,at)){aj.splice(am,1);aj.push([an,at]);ak--;am--}}for(var am=0;am<aj.length;am++){var an=aj[am][0];var at=aj[am][1];G(an,at)}}else{if(ar.which==3){if(!y&&!ac(au,ai)){if(!u(au,ai)&&!d(au,ai)){H(au,ai);q()}else{if(P&&u(au,ai)){f(au,ai);ag()}else{if(!P){ag()}N(au,ai)}}}}}}function S(ai){var ah=ai.data("coord").split(",");return[parseInt(ah[0],10),parseInt(ah[1],10)]}function H(aj,ah){var ai=M[aj][ah];if(!y&&!ai.triggered&&!ai.marked){M[aj][ah].flagged=true}R(aj,ah)}function f(aj,ah){var ai=M[aj][ah];if(!y&&!ai.triggered&&ai.flagged){ai.flagged=false;ai.marked=true}M[aj][ah]=ai;R(aj,ah)}function N(aj,ah){var ai=M[aj][ah];if(!y&&!ai.triggered){ai.marked=false;ai.flagged=false}M[aj][ah]=ai;R(aj,ah)}function G(aj,ah){var ai=M[aj][ah];if(y||ai.triggered||ai.flagged){return}ai.triggered=true;M[aj][ah]=ai;if(!i&&ai.isMine){o(aj,ah);return}else{if(i&&ai.isMine){M[aj][ah].isMine=false;W(aj,ah,true);p(aj,ah)}}R(aj,ah);if(ai.number==0&&!ai.isMine&&!ai.flagged){A(aj,ah)}if(--C==0){K()}i=false}function A(ap,ai){var ah=(ap==0)?0:ap-1;var ao=(ap==ab-1)?ab-1:ap+1;var am=(ai==0)?0:ai-1;var aj=(ai==aa-1)?aa-1:ai+1;for(var al=ah;al<=ao;al++){for(var ak=am;ak<=aj;ak++){var an=M[al][ak];if(an.number>0||(!an.isMine&&!an.flagged)){G(al,ak)}}}}function I(ai,ah){M[ai][ah].isMine=true}function o(ai,ah){var ak=M[ai][ah];if(!ak.isMine){return}ak.exploded=true;M[ai][ah]=ak;if(L){document.getElementById("snd_explode").play()}ad();for(var ai=0;ai<ab;ai++){for(var ah=0;ah<aa;ah++){var aj=M[ai][ah];var al=false;if(!aj.flagged&&aj.isMine){al=true}else{if(!aj.isMine&&aj.flagged){al=true;aj.number=0}}if(al){aj.triggered=true;M[ai][ah]=aj;R(ai,ah)}}}$(".smiley-icon").addClass("dead")}function ac(ai,ah){return M[ai][ah].triggered}function c(ai,ah){var aj=M[ai][ah];return !aj.triggered&&!aj.marked&&!aj.flagged}function af(ai,ah){return M[ai][ah].number!=0}function d(ai,ah){return M[ai][ah].marked}function u(ai,ah){return M[ai][ah].flagged}function h(ai,ah){return M[ai][ah].isMine}function B(ai,ah){return M[ai][ah].number}function R(ai,ah){var ak=$('.ms-panel[data-coord="'+ai+","+ah+'"]');var aj=M[ai][ah];ak.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(aj.triggered){ak.addClass("triggered");if(aj.number>0){ak.addClass("m"+aj.number)}if(aj.isMine){ak.addClass("mine")}if(aj.exploded){ak.addClass("exploded")}if(!aj.isMine&&aj.flagged){ak.addClass("bogus")}}else{if(aj.flagged){ak.addClass("flagged")}if(aj.marked){ak.addClass("marked")}}}function n(){X();E=setInterval(function(){X()},1000)}function g(){clearInterval(E)}function X(){if(T<999){T++;ae("time",T);if(L){document.getElementById("snd_tick").play()}}}function ag(){if(F<V){F++;ae("mines",F)}}function q(){if(F>-99){F--;ae("mines",(F>-100)?F:-99)}}function ae(ak,aj){ak=".num-box#"+ak;num=Math.abs(aj);var ai=Math.floor(num/100);num-=ai*100;var ah=Math.floor(num/10);num-=ah*10;if(aj<0){ai="n"}$(ak+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(ak+" .digit.iii").addClass("d"+ai);$(ak+" .digit.ii").addClass("d"+ah);$(ak+" .digit.i").addClass("d"+num)}function k(an,aj,aq,ao){ad();x=true;y=false;i=true;var ak={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(an>=0||an<=2){aj=ak.width[an];aq=ak.height[an];ao=ak.mines[an]}V=ao;F=ao;aa=aj;ab=aq;j=an;s=false;T=0;M=[];C=(aj*aq)-ao;w();ae("time",T);ae("mines",F);$(".smiley-icon").removeClass("active cool dead");t();if(Y){Y=false;var ap=e("SWEEP_SND");if(ap!==""){v(ap,true)}var ai=e("SWEEP_MRK");if(ai!==""){z(ai,true)}var am=e("SWEEP_LVL");var ah=e("SWEEP_WIDTH");var al=e("SWEEP_HEIGHT");if(am!==""){if(am!="3"||(ah!==""&&al!=="")){m(am,true)}}}$(".window#ms-main").css("display","inline-block")}function w(){var ak="";for(var aj=0;aj<ab;aj++){M.push([]);ak+="<div class='ms-row'>";for(var ai=0;ai<aa;ai++){M[aj].push(new a());ak+="<div class='ms-panel' data-coord='"+aj+","+ai+"'></div>"}ak+="</div>"}var ah=V;while(ah--){p()}$(".ms-grid").html(ak)}function p(ai,ak){var am=typeof ai!="undefined";var al=-1;var ah=-1;var aj=null;do{al=r(0,ab-1);ah=r(0,aa-1);aj=M[al][ah]}while(aj.isMine||(am&&al==ai&&ah==ak));M[al][ah].number=0;I(al,ah);W(al,ah)}function W(an,ak,ai){var am=b(an,ak);var ah=0;for(var al=am[0][0];al<=am[0][1];al++){for(var aj=am[1][0];aj<=am[1][1];aj++){if(h(al,aj)){ah++;continue}if((an==al&&ak==aj)){continue}if(!ai){M[al][aj].number++}else{M[al][aj].number--}}}if(ai){M[an][ak].number=ah}}function r(ai,ah){return Math.floor(Math.random()*(ah+1-ai))+ai}function b(al,aj){var ak=(al==0)?0:al-1;var am=(al==ab-1)?ab-1:al+1;var ah=(aj==0)?0:aj-1;var ai=(aj==aa-1)?aa-1:aj+1;return[[ak,am],[ah,ai]]}function D(){return !x&&!y}function O(){if(x){x=false;y=false;n()}}function ad(){y=true;g()}function K(){$(".smiley-icon").addClass("cool");if(L){document.getElementById("snd_win").play()}ad()}function l(ai,al,ak){ak*=86400000;var aj=new Date(Date.now()+ak);var ah="expires="+aj.toUTCString();document.cookie=ai+"="+al+"; "+ah}function e(ai){ai=ai+"=";var ah=document.cookie.split(";");for(var ak=0;ak<ah.length;ak++){var aj=ah[ak];while(aj.charAt(0)==" "){aj=aj.substring(1)}if(aj.indexOf(ai)==0){return aj.substring(ai.length,aj.length)}}return""}})();