(function(){if(typeof window.SweeperOSEnvironment=="undefined"){console.log("Sweeper OS envrionment is unavailable. Minesweeper cannot run.");return}var h=window.SweeperOSEnvironment;var M=null;var ad=0;var F=true;var l=true;var G=false;var A=false;var O=0;var af=0;var m=0;var ak=0;var al=0;var V=null;var K=0;var aj=false;var aa=false;var Z=true;var U=false;var P=true;var d=false;var am=9;var o=9;var q=10;var ai=true;var S=[["Anonymous",999],["Anonymous",999],["Anonymous",999]];function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(au){$(".smiley-icon").removeClass("active");aj=false;aa=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(au){if($(".window#ms-main").hasClass("focused")){if(au.which==113){au.preventDefault();n(m)}else{if(au.which==112){au.preventDefault()}}}if($(".window#ms-custom-board").hasClass("focused")){if(au.which==27){ap()}else{if(au.which==13){Y()}}}if($(".window#ms-high-score").hasClass("focused")){if(au.which==27||au.which==13){w()}}});$(".minesweeper").off("mousedown").on("mousedown",function(au){if(!G&&(au.which==1||au.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(au){n(m)});$("#game_new").on("click",function(au){n(m)});$("#game_beg:not(.disabled)").on("click",function(au){r(0)});$("#game_int:not(.disabled)").on("click",function(au){r(1)});$("#game_exp:not(.disabled)").on("click",function(au){r(2)});$("#game_cst:not(.disabled)").on("click",function(av){var au=$(".minesweeper").offset();$("#ms-custom-board #cst-height").val(o);$("#ms-custom-board #cst-width").val(am);$("#ms-custom-board #cst-mines").val(q);h.showWindow($("#ms-custom-board"),au.left,au.top,$("#ms-main"))});$("#game_mrk:not(.disabled)").on("click",function(au){H(!Z)});$("#game_snd:not(.disabled)").on("click",function(au){D(!U)});$("#game_clr:not(.disabled)").on("click",function(au){z(!P)});$("#cst_ok").on("click",Y);$("#cst_cancel").on("click",ap);$("#hs_ok").on("click",w);n(0)});function Y(){var aw=$("#cst-width").val();var av=$("#cst-height").val();var au=$("#cst-mines").val();x(aw,av,au);r(3);h.closeWindow($("#ms-custom-board"))}function ap(){n(m);h.closeWindow($("#ms-custom-board"))}function w(){g(m,$("#ms-high-score #hs-name").val(),ad);h.closeWindow($("#ms-high-score"))}function D(av,au){if(av==true){U=true;$("#game_snd").addClass("checked")}else{U=false;$("#game_snd").removeClass("checked")}if(!au){p("SWEEP_SND",U?1:0,365)}}function H(av,au){if(av==true){Z=true;$("#game_mrk").addClass("checked")}else{Z=false;$("#game_mrk").removeClass("checked")}if(!au){p("SWEEP_MRK",Z?1:0,365)}}function z(av,au){if(av==true){P=true;$("#game_clr").addClass("checked");$(".minesweeper").removeClass("no-color")}else{P=false;$("#game_clr").removeClass("checked");$(".minesweeper").addClass("no-color")}if(!au){p("SWEEP_CLR",P?1:0,365)}}function r(ay,au){if(ay<0||ay>3){return}if(ay!=3){am=9;o=9;q=10;d=false}var av=["beg","int","exp","cst"];for(var ax=0;ax<av.length;ax++){var aw=$("#game_"+av[ax]);if(ax==ay){aw.addClass("checked")}else{aw.removeClass("checked")}}if(!au){p("SWEEP_LVL",ay,365)}n(ay)}function x(ax,au,ay,aw){if(!/^\d*$/.test(ax)){ax=9}ax=(ax>30?30:ax);ax=(ax<9?9:ax);if(!/^\d*$/.test(au)){au=9}au=(au>24?24:au);au=(au<9?9:au);if(!/^\d*$/.test(ay)){ay=10}ay=(ay<10?10:ay);var av=(au-1)*(ax-1);ay=(ay>av?av:ay);d=true;am=ax;o=au;q=ay;if(!aw){p("SWEEP_WIDTH",ax,365);p("SWEEP_HEIGHT",au,365);p("SWEEP_MINES",ay,365)}}function B(){$(".window *").off("contextmenu").on("contextmenu",function(au){au.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(av){if(!G){switch(av.which){case 1:aj=true;$(this).trigger("mouseenter");break;case 2:aa=true;$(this).trigger("mouseenter");break;case 3:var au=$(this);ae(au,av);break}}});$(".ms-panel").off("mouseenter").on("mouseenter",function(ay){if(aj&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(aa){var ax=ac($(this));var aw=b(ax[0],ax[1]);for(var av=aw[0][0];av<=aw[0][1];av++){for(var au=aw[1][0];au<=aw[1][1];au++){if(!C(av,au)){$('.ms-panel[data-coord="'+av+","+au+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(au){if((aj||aa)&&(au.which==1||au.which==2)){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(av){if((aj||aa)&&!G){if(F){X()}var au=$(this);ae(au,av)}})}function ae(aD,aE){if(!aD.length||!aD.hasClass("ms-panel")){return}var aB=ac(aD);var aG=aB[0];var av=aB[1];if(aE.which==1){$(".smiley-icon").removeClass("active");aj=false;if(!G){if(!an(aG,av)){N(aG,av)}}}if(aE.which==2&&ar(aG,av)&&an(aG,av)){var au=b(aG,av);var aw=[];var aC=J(aG,av);for(var az=au[0][0];az<=au[0][1];az++){for(var ay=au[1][0];ay<=au[1][1];ay++){if(az==aG&&ay==av){continue}if(C(az,ay)){aC--}else{aw.push([az,ay])}}}if(aC!==0){return}var ax=aw.length;for(var az=0;az<ax;az++){var aA=aw[az][0];var aF=aw[az][1];if(k(aA,aF)){aw.splice(az,1);aw.push([aA,aF]);ax--;az--}}for(var az=0;az<aw.length;az++){var aA=aw[az][0];var aF=aw[az][1];N(aA,aF)}}else{if(aE.which==3){if(!G&&!an(aG,av)){if(!C(aG,av)&&!e(aG,av)){R(aG,av);v()}else{if(Z&&C(aG,av)){i(aG,av);at()}else{if(!Z){at()}W(aG,av)}}}}}}function ac(av){var au=av.data("coord").split(",");return[parseInt(au[0],10),parseInt(au[1],10)]}function R(aw,au){var av=V[aw][au];if(!G&&!av.triggered&&!av.marked){V[aw][au].flagged=true}ab(aw,au)}function i(aw,au){var av=V[aw][au];if(!G&&!av.triggered&&av.flagged){av.flagged=false;av.marked=true}V[aw][au]=av;ab(aw,au)}function W(aw,au){var av=V[aw][au];if(!G&&!av.triggered){av.marked=false;av.flagged=false}V[aw][au]=av;ab(aw,au)}function N(aw,au){var av=V[aw][au];if(G||av.triggered||av.flagged){return}av.triggered=true;V[aw][au]=av;if(!l&&av.isMine){t(aw,au);return}else{if(l&&av.isMine){V[aw][au].isMine=false;ag(aw,au,true);u(aw,au)}}ab(aw,au);if(av.number==0&&!av.isMine&&!av.flagged){I(aw,au)}if(--K==0){T()}l=false}function I(aC,av){var au=(aC==0)?0:aC-1;var aB=(aC==al-1)?al-1:aC+1;var az=(av==0)?0:av-1;var aw=(av==ak-1)?ak-1:av+1;for(var ay=au;ay<=aB;ay++){for(var ax=az;ax<=aw;ax++){var aA=V[ay][ax];if(aA.number>0||(!aA.isMine&&!aA.flagged)){N(ay,ax)}}}}function Q(av,au){V[av][au].isMine=true}function t(av,au){var ax=V[av][au];if(!ax.isMine){return}ax.exploded=true;V[av][au]=ax;if(U){document.getElementById("snd_explode").play()}ao();for(var av=0;av<al;av++){for(var au=0;au<ak;au++){var aw=V[av][au];var ay=false;if(!aw.flagged&&aw.isMine){ay=true}else{if(!aw.isMine&&aw.flagged){ay=true;aw.number=0}}if(ay){aw.triggered=true;V[av][au]=aw;ab(av,au)}}}$(".smiley-icon").addClass("dead")}function an(av,au){return V[av][au].triggered}function c(av,au){var aw=V[av][au];return !aw.triggered&&!aw.marked&&!aw.flagged}function ar(av,au){return V[av][au].number!=0}function e(av,au){return V[av][au].marked}function C(av,au){return V[av][au].flagged}function k(av,au){return V[av][au].isMine}function J(av,au){return V[av][au].number}function ab(av,au){var ax=$('.ms-panel[data-coord="'+av+","+au+'"]');var aw=V[av][au];ax.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(aw.triggered){ax.addClass("triggered");if(aw.number>0){ax.addClass("m"+aw.number)}if(aw.isMine){ax.addClass("mine")}if(aw.exploded){ax.addClass("exploded")}if(!aw.isMine&&aw.flagged){ax.addClass("bogus")}}else{if(aw.flagged){ax.addClass("flagged")}if(aw.marked){ax.addClass("marked")}}}function s(){ah();M=setInterval(function(){ah()},1000)}function j(){clearInterval(M)}function ah(){if(ad<999){ad++;aq("time",ad);if(U){document.getElementById("snd_tick").play()}}}function at(){if(O<af){O++;aq("mines",O)}}function v(){if(O>-99){O--;aq("mines",(O>-100)?O:-99)}}function aq(ax,aw){ax=".num-box#"+ax;num=Math.abs(aw);var av=Math.floor(num/100);num-=av*100;var au=Math.floor(num/10);num-=au*10;if(aw<0){av="n"}$(ax+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(ax+" .digit.iii").addClass("d"+av);$(ax+" .digit.ii").addClass("d"+au);$(ax+" .digit.i").addClass("d"+num)}function n(aD){ao();F=true;G=false;l=true;if(aD<0||aD>3||(aD==3&&!d)){aD=0}var ay={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(aD!=3){var aw=ay.width[aD];var aG=ay.height[aD];var aE=ay.mines[aD]}else{var aw=am;var aG=o;var aE=q}af=aE;O=aE;ak=aw;al=aG;m=aD;A=false;ad=0;V=[];K=(aw*aG)-aE;if(ai){ai=false;var aB=f("SWEEP_TOP");try{if(aB!==""){S=$.parseJSON(aB)}}catch(aA){console.log("Error: leaderboard data is corrupt. Resetting to default...");p("SWEEP_TOP",S,365)}var aF=f("SWEEP_SND");if(aF==""){aF=false}D(aF,true);var av=f("SWEEP_MRK");if(av==""){av=true}H(av,true);var ax=f("SWEEP_CLR");if(ax==""){ax=true}z(ax,true);var aC=f("SWEEP_LVL");var au=f("SWEEP_WIDTH");var az=f("SWEEP_HEIGHT");var aH=f("SWEEP_MINES");if(aC!==""){if(aC!=3||(au!==""&&az!==""&&aH!=="")){if(aC==3){x(au,az,aH,true)}r(aC,true);return}}}E();aq("time",ad);aq("mines",O);$(".smiley-icon").removeClass("active cool dead");B();h.showWindow($("#ms-main"))}function E(){var ax="";for(var aw=0;aw<al;aw++){V.push([]);ax+="<div class='ms-row'>";for(var av=0;av<ak;av++){V[aw].push(new a());ax+="<div class='ms-panel' data-coord='"+aw+","+av+"'></div>"}ax+="</div>"}var au=af;while(au--){u()}$(".ms-grid").html(ax)}function u(av,ax){var az=typeof av!="undefined";var ay=-1;var au=-1;var aw=null;do{ay=y(0,al-1);au=y(0,ak-1);aw=V[ay][au]}while(aw.isMine||(az&&ay==av&&au==ax));V[ay][au].number=0;Q(ay,au);ag(ay,au)}function ag(aA,ax,av){var az=b(aA,ax);var au=0;for(var ay=az[0][0];ay<=az[0][1];ay++){for(var aw=az[1][0];aw<=az[1][1];aw++){if(k(ay,aw)){au++;continue}if((aA==ay&&ax==aw)){continue}if(!av){V[ay][aw].number++}else{V[ay][aw].number--}}}if(av){V[aA][ax].number=au}}function y(av,au){return Math.floor(Math.random()*(au+1-av))+av}function b(ay,aw){var ax=(ay==0)?0:ay-1;var az=(ay==al-1)?al-1:ay+1;var au=(aw==0)?0:aw-1;var av=(aw==ak-1)?ak-1:aw+1;return[[ax,az],[au,av]]}function L(){return !F&&!G}function X(){if(F){F=false;G=false;s()}}function ao(){G=true;j()}function T(){$(".smiley-icon").addClass("cool");if(U){document.getElementById("snd_win").play()}if(m<3&&m>=0){if(S[m][1]>ad){var aw=["beginner","intermediate","expert"];var au=$("#ms-high-score #hs-description");var ay=au.data("hs-msg").replace("%LEVEL%",aw[m]);au.html(ay);$("#ms-high-score #hs-name").val(S[m][0]);var ax=$(".minesweeper").offset();var av=$(".ms-status").offset().top+$(".ms-status").outerHeight();h.showWindow($("#ms-high-score"),ax.left,av,$("#ms-main"));$("#ms-high-score #hs-name").select()}}ao()}function g(au,av,aw){if(au<0||au>2||aw<0||aw>999){return}S[au][0]=av;S[au][1]=aw;p("SWEEP_TOP",JSON.stringify(S),365)}function p(av,ay,ax){ax*=86400000;var aw=new Date(Date.now()+ax);var au="expires="+aw.toUTCString();document.cookie=av+"="+ay+"; "+au}function f(av){av=av+"=";var au=document.cookie.split(";");for(var ax=0;ax<au.length;ax++){var aw=au[ax];while(aw.charAt(0)==" "){aw=aw.substring(1)}if(aw.indexOf(av)==0){return aw.substring(av.length,aw.length)}}return""}})();