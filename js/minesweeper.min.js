(function(){var x=null;var N=0;var s=true;var g=true;var t=false;var o=false;var y=0;var P=0;var h=0;var T=0;var U=0;var F=null;var v=0;var S=false;var I=true;var E=false;var K=new Audio("snd/win.ogg");var M=new Audio("snd/explode.ogg");var A=new Audio("snd/boop.ogg");function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(Z){if(!t){$(".smiley-icon").removeClass("active");S=false}});$("body").on("keydown",function(Z){if($(".window#ms-main").hasClass("focused")){if(Z.which==113){Z.preventDefault();i(h)}else{if(Z.which==112){Z.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(Z){if(!t&&Z.which==1){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(Z){i(h)});$("#game_new").on("click",function(Z){i(h)});$("#game_beg:not(.disabled)").on("click",function(Z){i(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});$("#game_int:not(.disabled)").on("click",function(Z){i(1);$("#game_beg").removeClass("checked");$("#game_int").addClass("checked");$("#game_exp").removeClass("checked")});$("#game_exp:not(.disabled)").on("click",function(Z){i(2);$("#game_beg").removeClass("checked");$("#game_int").removeClass("checked");$("#game_exp").addClass("checked")});$("#game_cst:not(.disabled)").on("click",function(Z){i(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});$("#game_mrk:not(.disabled)").on("click",function(Z){I=!I;$("#game_mrk").removeClass("checked");if(I){$("#game_mrk").addClass("checked")}});$("#game_snd:not(.disabled)").on("click",function(Z){E=!E;$("#game_snd").removeClass("checked");if(E){$("#game_snd").addClass("checked")}});i(0)});function p(){$(".window *").off("contextmenu").on("contextmenu",function(Z){Z.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(aa){if(aa.which==1&&!t){S=true}else{if(aa.which==3&&!t){var Z=$(this);O(Z,aa)}}});$(".ms-panel").off("mousenter").on("mouseenter",function(Z){if(S&&!$(this).hasClass("flagged")){$(this).addClass("down")}});$(".ms-panel").off("mouseleave").on("mouseleave",function(Z){if(Z.which==1&&!$(this).hasClass("triggered")){$(this).removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(aa){if(S&&!t){if(s){H()}var Z=$(this);O(Z,aa)}})}function O(ab,aa){aa.stopPropagation();if(!ab.length||!ab.hasClass("ms-panel")){return}var ad=L(ab);var ac=ad[0];var Z=ad[1];if(aa.which==1){$(".smiley-icon").removeClass("active");S=false;if(!t){if(!V(ac,Z)){z(ac,Z)}}}else{if(aa.which==3){if(!t&&!V(ac,Z)){if(!q(ac,Z)&&!c(ac,Z)){B(ac,Z);m()}else{if(I&&q(ac,Z)){d(ac,Z);Y()}else{if(!I){Y()}G(ac,Z)}}}}}}function L(aa){var Z=aa.data("coord").split(",");return[parseInt(Z[0],10),parseInt(Z[1],10)]}function B(ab,Z){var aa=F[ab][Z];if(!t&&!aa.triggered&&!aa.marked){F[ab][Z].flagged=true}J(ab,Z)}function d(ab,Z){var aa=F[ab][Z];if(!t&&!aa.triggered&&aa.flagged){aa.flagged=false;aa.marked=true}F[ab][Z]=aa;J(ab,Z)}function G(ab,Z){var aa=F[ab][Z];if(!t&&!aa.triggered){aa.marked=false;aa.flagged=false}F[ab][Z]=aa;J(ab,Z)}function z(ab,Z){var aa=F[ab][Z];if(t||aa.triggered||aa.flagged){return}aa.triggered=true;F[ab][Z]=aa;if(!g&&aa.isMine){k(ab,Z);return}else{if(g&&aa.isMine){F[ab][Z].isMine=false;Q(ab,Z,true);l(ab,Z)}}J(ab,Z);if(aa.number==0&&!aa.isMine&&!aa.flagged){u(ab,Z)}if(--v==0){D()}g=false}function u(ah,aa){var Z=(ah==0)?0:ah-1;var ag=(ah==U-1)?U-1:ah+1;var ae=(aa==0)?0:aa-1;var ab=(aa==T-1)?T-1:aa+1;for(var ad=Z;ad<=ag;ad++){for(var ac=ae;ac<=ab;ac++){var af=F[ad][ac];if(af.number>0||(!af.isMine&&!af.flagged)){z(ad,ac)}}}}function C(aa,Z){F[aa][Z].isMine=true}function k(aa,Z){var ac=F[aa][Z];if(!ac.isMine){return}ac.exploded=true;F[aa][Z]=ac;if(E){M.play()}W();for(var aa=0;aa<U;aa++){for(var Z=0;Z<T;Z++){var ab=F[aa][Z];var ad=false;if(!ab.flagged&&ab.isMine){ad=true}else{if(!ab.isMine&&ab.flagged){ad=true;ab.number=0}}if(ad){ab.triggered=true;F[aa][Z]=ab;J(aa,Z)}}}$(".smiley-icon").addClass("dead")}function V(aa,Z){return F[aa][Z].triggered}function b(aa,Z){var ab=F[aa][Z];return !ab.triggered&&!ab.marked&&!ab.flagged}function c(aa,Z){return F[aa][Z].marked}function q(aa,Z){return F[aa][Z].flagged}function f(aa,Z){return F[aa][Z].isMine}function J(aa,Z){var ac=$('.ms-panel[data-coord="'+aa+","+Z+'"]');var ab=F[aa][Z];ac.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(ab.triggered){ac.addClass("triggered");if(ab.number>0){ac.addClass("m"+ab.number)}if(ab.isMine){ac.addClass("mine")}if(ab.exploded){ac.addClass("exploded")}if(!ab.isMine&&ab.flagged){ac.addClass("bogus")}}else{if(ab.flagged){ac.addClass("flagged")}if(ab.marked){ac.addClass("marked")}}}function j(){R();x=setInterval(function(){R()},1000)}function e(){clearInterval(x)}function R(){if(N<999){N++;X("time",N);if(E){A.play()}}}function Y(){if(y<P){y++;X("mines",y)}}function m(){if(y>-99){y--;X("mines",(y>-100)?y:-99)}}function X(ac,ab){ac=".num-box#"+ac;num=Math.abs(ab);var aa=Math.floor(num/100);num-=aa*100;var Z=Math.floor(num/10);num-=Z*10;if(ab<0){aa="n"}$(ac+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(ac+" .digit.iii").addClass("d"+aa);$(ac+" .digit.ii").addClass("d"+Z);$(ac+" .digit.i").addClass("d"+num)}function i(ad,aa,Z,ab){W();s=true;t=false;g=true;var ac={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(ad>=0||ad<=2){aa=ac.width[ad];Z=ac.height[ad];ab=ac.mines[ad]}P=ab;y=ab;T=aa;U=Z;h=ad;o=false;N=0;F=[];v=(aa*Z)-ab;r();X("time",N);X("mines",y);$(".smiley-icon").removeClass("active cool dead");p();$(".window#ms-main").css("display","inline-block")}function r(){var ac="";for(var ab=0;ab<U;ab++){F.push([]);ac+="<div class='ms-row'>";for(var aa=0;aa<T;aa++){F[ab].push(new a());ac+="<div class='ms-panel' data-coord='"+ab+","+aa+"'></div>"}ac+="</div>"}var Z=P;while(Z--){l()}$(".ms-grid").html(ac)}function l(aa,ac){var ae=typeof aa!="undefined";var ad=-1;var Z=-1;var ab=null;do{ad=n(0,U-1);Z=n(0,T-1);ab=F[ad][Z]}while(ab.isMine||(ae&&ad==aa&&Z==ac));F[ad][Z].number=0;C(ad,Z);Q(ad,Z)}function Q(ai,ab,ag){var aa=(ai==0)?0:ai-1;var ah=(ai==U-1)?U-1:ai+1;var af=(ab==0)?0:ab-1;var ac=(ab==T-1)?T-1:ab+1;var Z=0;for(var ae=aa;ae<=ah;ae++){for(var ad=af;ad<=ac;ad++){if(f(ae,ad)){Z++;continue}if((ai==ae&&ab==ad)){continue}if(!ag){F[ae][ad].number++}else{F[ae][ad].number--}}}if(ag){F[ai][ab].number=Z}}function n(aa,Z){return Math.floor(Math.random()*(Z+1-aa))+aa}function w(){return !s&&!t}function H(){if(s){s=false;t=false;j()}}function W(){t=true;e()}function D(){$(".smiley-icon").addClass("cool");if(E){K.play()}W()}})();