(function(){var z=null;var N=0;var t=true;var h=true;var u=false;var p=false;var A=0;var P=0;var i=0;var T=0;var U=0;var G=null;var x=0;var S=false;var K=false;var J=true;var F=false;function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(aa){$(".smiley-icon").removeClass("active");S=false;K=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(aa){if($(".window#ms-main").hasClass("focused")){if(aa.which==113){aa.preventDefault();j(i)}else{if(aa.which==112){aa.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(aa){if(!u&&(aa.which==1||aa.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(aa){j(i)});$("#game_new").on("click",function(aa){j(i)});$("#game_beg:not(.disabled)").on("click",function(aa){j(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});$("#game_int:not(.disabled)").on("click",function(aa){j(1);$("#game_beg").removeClass("checked");$("#game_int").addClass("checked");$("#game_exp").removeClass("checked")});$("#game_exp:not(.disabled)").on("click",function(aa){j(2);$("#game_beg").removeClass("checked");$("#game_int").removeClass("checked");$("#game_exp").addClass("checked")});$("#game_cst:not(.disabled)").on("click",function(aa){j(0);$("#game_beg").addClass("checked");$("#game_int").removeClass("checked");$("#game_exp").removeClass("checked")});$("#game_mrk:not(.disabled)").on("click",function(aa){J=!J;$("#game_mrk").removeClass("checked");if(J){$("#game_mrk").addClass("checked")}});$("#game_snd:not(.disabled)").on("click",function(aa){F=!F;$("#game_snd").removeClass("checked");if(F){$("#game_snd").addClass("checked")}});j(0)});function q(){$(".window *").off("contextmenu").on("contextmenu",function(aa){aa.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(ab){if(!u){switch(ab.which){case 1:S=true;$(this).trigger("mouseenter");break;case 2:K=true;$(this).trigger("mouseenter");break;case 3:var aa=$(this);O(aa,ab);break}}});$(".ms-panel").off("mousenter").on("mouseenter",function(ae){if(S&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(K){var ad=M($(this));var ac=b(ad[0],ad[1]);for(var ab=ac[0][0];ab<=ac[0][1];ab++){for(var aa=ac[1][0];aa<=ac[1][1];aa++){if(!r(ab,aa)){$('.ms-panel[data-coord="'+ab+","+aa+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(aa){if(aa.which==1||aa.which==2){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(ab){if((S||K)&&!u){if(t){I()}var aa=$(this);O(aa,ab);$("body").trigger("mouseup")}})}function O(aj,ak){ak.stopPropagation();if(!aj.length||!aj.hasClass("ms-panel")){return}var ah=M(aj);var am=ah[0];var ab=ah[1];if(ak.which==1){$(".smiley-icon").removeClass("active");S=false;if(!u){if(!V(am,ab)){B(am,ab)}}}if(ak.which==2&&Y(am,ab)&&V(am,ab)){var aa=b(am,ab);var ac=[];var ai=w(am,ab);for(var af=aa[0][0];af<=aa[0][1];af++){for(var ae=aa[1][0];ae<=aa[1][1];ae++){if(af==am&&ae==ab){continue}if(r(af,ae)){ai--}else{ac.push([af,ae])}}}if(ai!==0){return}var ad=ac.length;for(var af=0;af<ad;af++){var ag=ac[af][0];var al=ac[af][1];if(g(ag,al)){ac.splice(af,1);ac.push([ag,al]);ad--;af--}}for(var af=0;af<ac.length;af++){var ag=ac[af][0];var al=ac[af][1];B(ag,al)}}else{if(ak.which==3){if(!u&&!V(am,ab)){if(!r(am,ab)&&!d(am,ab)){C(am,ab);n()}else{if(J&&r(am,ab)){e(am,ab);Z()}else{if(!J){Z()}H(am,ab)}}}}}}function M(ab){var aa=ab.data("coord").split(",");return[parseInt(aa[0],10),parseInt(aa[1],10)]}function C(ac,aa){var ab=G[ac][aa];if(!u&&!ab.triggered&&!ab.marked){G[ac][aa].flagged=true}L(ac,aa)}function e(ac,aa){var ab=G[ac][aa];if(!u&&!ab.triggered&&ab.flagged){ab.flagged=false;ab.marked=true}G[ac][aa]=ab;L(ac,aa)}function H(ac,aa){var ab=G[ac][aa];if(!u&&!ab.triggered){ab.marked=false;ab.flagged=false}G[ac][aa]=ab;L(ac,aa)}function B(ac,aa){var ab=G[ac][aa];if(u||ab.triggered||ab.flagged){return}ab.triggered=true;G[ac][aa]=ab;if(!h&&ab.isMine){l(ac,aa);return}else{if(h&&ab.isMine){G[ac][aa].isMine=false;Q(ac,aa,true);m(ac,aa)}}L(ac,aa);if(ab.number==0&&!ab.isMine&&!ab.flagged){v(ac,aa)}if(--x==0){E()}h=false}function v(ai,ab){var aa=(ai==0)?0:ai-1;var ah=(ai==U-1)?U-1:ai+1;var af=(ab==0)?0:ab-1;var ac=(ab==T-1)?T-1:ab+1;for(var ae=aa;ae<=ah;ae++){for(var ad=af;ad<=ac;ad++){var ag=G[ae][ad];if(ag.number>0||(!ag.isMine&&!ag.flagged)){B(ae,ad)}}}}function D(ab,aa){G[ab][aa].isMine=true}function l(ab,aa){var ad=G[ab][aa];if(!ad.isMine){return}ad.exploded=true;G[ab][aa]=ad;if(F){document.getElementById("snd_explode").play()}W();for(var ab=0;ab<U;ab++){for(var aa=0;aa<T;aa++){var ac=G[ab][aa];var ae=false;if(!ac.flagged&&ac.isMine){ae=true}else{if(!ac.isMine&&ac.flagged){ae=true;ac.number=0}}if(ae){ac.triggered=true;G[ab][aa]=ac;L(ab,aa)}}}$(".smiley-icon").addClass("dead")}function V(ab,aa){return G[ab][aa].triggered}function c(ab,aa){var ac=G[ab][aa];return !ac.triggered&&!ac.marked&&!ac.flagged}function Y(ab,aa){return G[ab][aa].number!=0}function d(ab,aa){return G[ab][aa].marked}function r(ab,aa){return G[ab][aa].flagged}function g(ab,aa){return G[ab][aa].isMine}function w(ab,aa){return G[ab][aa].number}function L(ab,aa){var ad=$('.ms-panel[data-coord="'+ab+","+aa+'"]');var ac=G[ab][aa];ad.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(ac.triggered){ad.addClass("triggered");if(ac.number>0){ad.addClass("m"+ac.number)}if(ac.isMine){ad.addClass("mine")}if(ac.exploded){ad.addClass("exploded")}if(!ac.isMine&&ac.flagged){ad.addClass("bogus")}}else{if(ac.flagged){ad.addClass("flagged")}if(ac.marked){ad.addClass("marked")}}}function k(){R();z=setInterval(function(){R()},1000)}function f(){clearInterval(z)}function R(){if(N<999){N++;X("time",N);if(F){document.getElementById("snd_tick").play()}}}function Z(){if(A<P){A++;X("mines",A)}}function n(){if(A>-99){A--;X("mines",(A>-100)?A:-99)}}function X(ad,ac){ad=".num-box#"+ad;num=Math.abs(ac);var ab=Math.floor(num/100);num-=ab*100;var aa=Math.floor(num/10);num-=aa*10;if(ac<0){ab="n"}$(ad+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(ad+" .digit.iii").addClass("d"+ab);$(ad+" .digit.ii").addClass("d"+aa);$(ad+" .digit.i").addClass("d"+num)}function j(ae,ab,aa,ac){W();t=true;u=false;h=true;var ad={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(ae>=0||ae<=2){ab=ad.width[ae];aa=ad.height[ae];ac=ad.mines[ae]}P=ac;A=ac;T=ab;U=aa;i=ae;p=false;N=0;G=[];x=(ab*aa)-ac;s();X("time",N);X("mines",A);$(".smiley-icon").removeClass("active cool dead");q();$(".window#ms-main").css("display","inline-block")}function s(){var ad="";for(var ac=0;ac<U;ac++){G.push([]);ad+="<div class='ms-row'>";for(var ab=0;ab<T;ab++){G[ac].push(new a());ad+="<div class='ms-panel' data-coord='"+ac+","+ab+"'></div>"}ad+="</div>"}var aa=P;while(aa--){m()}$(".ms-grid").html(ad)}function m(ab,ad){var af=typeof ab!="undefined";var ae=-1;var aa=-1;var ac=null;do{ae=o(0,U-1);aa=o(0,T-1);ac=G[ae][aa]}while(ac.isMine||(af&&ae==ab&&aa==ad));G[ae][aa].number=0;D(ae,aa);Q(ae,aa)}function Q(ag,ad,ab){var af=b(ag,ad);var aa=0;for(var ae=af[0][0];ae<=af[0][1];ae++){for(var ac=af[1][0];ac<=af[1][1];ac++){if(g(ae,ac)){aa++;continue}if((ag==ae&&ad==ac)){continue}if(!ab){G[ae][ac].number++}else{G[ae][ac].number--}}}if(ab){G[ag][ad].number=aa}}function o(ab,aa){return Math.floor(Math.random()*(aa+1-ab))+ab}function b(ae,ac){var ad=(ae==0)?0:ae-1;var af=(ae==U-1)?U-1:ae+1;var aa=(ac==0)?0:ac-1;var ab=(ac==T-1)?T-1:ac+1;return[[ad,af],[aa,ab]]}function y(){return !t&&!u}function I(){if(t){t=false;u=false;k()}}function W(){u=true;f()}function E(){$(".smiley-icon").addClass("cool");if(F){document.getElementById("snd_win").play()}W()}})();