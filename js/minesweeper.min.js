(function(){if(typeof window.SweeperOSEnvironment=="undefined"){console.log("Sweeper OS envrionment is unavailable. Minesweeper cannot run.");return}var g=window.SweeperOSEnvironment;var J=null;var Z=0;var C=true;var k=true;var D=false;var x=false;var L=0;var ab=0;var l=0;var ag=0;var ah=0;var R=null;var H=0;var af=false;var W=false;var V=true;var Q=false;var d=false;var ai=9;var n=9;var p=10;var ae=true;var O=[["Anonymous",999],["Anonymous",999],["Anonymous",999]];function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(ap){$(".smiley-icon").removeClass("active");af=false;W=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(ap){if($(".window#ms-main").hasClass("focused")){if(ap.which==113){ap.preventDefault();m(l)}else{if(ap.which==112){ap.preventDefault()}}}if($(".window#ms-custom-board").hasClass("focused")){if(ap.which==27){al()}else{if(ap.which==13){U()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(ap){if(!D&&(ap.which==1||ap.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(ap){m(l)});$("#game_new").on("click",function(ap){m(l)});$("#game_beg:not(.disabled)").on("click",function(ap){q(0)});$("#game_int:not(.disabled)").on("click",function(ap){q(1)});$("#game_exp:not(.disabled)").on("click",function(ap){q(2)});$("#game_cst:not(.disabled)").on("click",function(aq){var ap=$(".minesweeper").offset();$("#ms-custom-board #cst-height").val(n);$("#ms-custom-board #cst-width").val(ai);$("#ms-custom-board #cst-mines").val(p);g.showWindow($("#ms-custom-board"),ap.left,ap.top,$("#ms-main"))});$("#game_mrk:not(.disabled)").on("click",function(ap){E(!V)});$("#game_snd:not(.disabled)").on("click",function(ap){A(!Q)});$("#cst_ok").on("click",U);$("#cst_cancel").on("click",al);m(0)});function U(){var ar=$("#cst-width").val();var aq=$("#cst-height").val();var ap=$("#cst-mines").val();v(ar,aq,ap);q(3);g.closeWindow($("#ms-custom-board"))}function al(){m(l);g.closeWindow($("#ms-custom-board"))}function A(aq,ap){if(aq==true){Q=true;$("#game_snd").addClass("checked")}else{Q=false;$("#game_snd").removeClass("checked")}if(!ap){o("SWEEP_SND",Q?1:0,365)}}function E(aq,ap){if(aq==true){V=true;$("#game_mrk").addClass("checked")}else{V=false;$("#game_mrk").removeClass("checked")}if(!ap){o("SWEEP_MRK",V?1:0,365)}}function q(au,ap){if(au<0||au>3){return}if(au!=3){ai=9;n=9;p=10;d=false}var aq=["beg","int","exp","cst"];for(var at=0;at<aq.length;at++){var ar=$("#game_"+aq[at]);if(at==au){ar.addClass("checked")}else{ar.removeClass("checked")}}if(!ap){o("SWEEP_LVL",au,365)}m(au)}function v(at,ap,au,ar){if(!/^\d*$/.test(at)){at=9}at=(at>30?30:at);at=(at<9?9:at);if(!/^\d*$/.test(ap)){ap=9}ap=(ap>24?24:ap);ap=(ap<9?9:ap);if(!/^\d*$/.test(au)){au=10}au=(au<10?10:au);var aq=(ap-1)*(at-1);au=(au>aq?aq:au);d=true;ai=at;n=ap;p=au;if(!ar){o("SWEEP_WIDTH",at,365);o("SWEEP_HEIGHT",ap,365);o("SWEEP_MINES",au,365)}}function y(){$(".window *").off("contextmenu").on("contextmenu",function(ap){ap.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(aq){if(!D){switch(aq.which){case 1:af=true;$(this).trigger("mouseenter");break;case 2:W=true;$(this).trigger("mouseenter");break;case 3:var ap=$(this);aa(ap,aq);break}}});$(".ms-panel").off("mouseenter").on("mouseenter",function(au){if(af&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(W){var at=Y($(this));var ar=b(at[0],at[1]);for(var aq=ar[0][0];aq<=ar[0][1];aq++){for(var ap=ar[1][0];ap<=ar[1][1];ap++){if(!z(aq,ap)){$('.ms-panel[data-coord="'+aq+","+ap+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(ap){if((af||W)&&(ap.which==1||ap.which==2)){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(aq){if((af||W)&&!D){if(C){T()}var ap=$(this);aa(ap,aq)}})}function aa(az,aA){if(!az.length||!az.hasClass("ms-panel")){return}var ax=Y(az);var aC=ax[0];var aq=ax[1];if(aA.which==1){$(".smiley-icon").removeClass("active");af=false;if(!D){if(!aj(aC,aq)){K(aC,aq)}}}if(aA.which==2&&an(aC,aq)&&aj(aC,aq)){var ap=b(aC,aq);var ar=[];var ay=G(aC,aq);for(var av=ap[0][0];av<=ap[0][1];av++){for(var au=ap[1][0];au<=ap[1][1];au++){if(av==aC&&au==aq){continue}if(z(av,au)){ay--}else{ar.push([av,au])}}}if(ay!==0){return}var at=ar.length;for(var av=0;av<at;av++){var aw=ar[av][0];var aB=ar[av][1];if(j(aw,aB)){ar.splice(av,1);ar.push([aw,aB]);at--;av--}}for(var av=0;av<ar.length;av++){var aw=ar[av][0];var aB=ar[av][1];K(aw,aB)}}else{if(aA.which==3){if(!D&&!aj(aC,aq)){if(!z(aC,aq)&&!e(aC,aq)){N(aC,aq);u()}else{if(V&&z(aC,aq)){h(aC,aq);ao()}else{if(!V){ao()}S(aC,aq)}}}}}}function Y(aq){var ap=aq.data("coord").split(",");return[parseInt(ap[0],10),parseInt(ap[1],10)]}function N(ar,ap){var aq=R[ar][ap];if(!D&&!aq.triggered&&!aq.marked){R[ar][ap].flagged=true}X(ar,ap)}function h(ar,ap){var aq=R[ar][ap];if(!D&&!aq.triggered&&aq.flagged){aq.flagged=false;aq.marked=true}R[ar][ap]=aq;X(ar,ap)}function S(ar,ap){var aq=R[ar][ap];if(!D&&!aq.triggered){aq.marked=false;aq.flagged=false}R[ar][ap]=aq;X(ar,ap)}function K(ar,ap){var aq=R[ar][ap];if(D||aq.triggered||aq.flagged){return}aq.triggered=true;R[ar][ap]=aq;if(!k&&aq.isMine){s(ar,ap);return}else{if(k&&aq.isMine){R[ar][ap].isMine=false;ac(ar,ap,true);t(ar,ap)}}X(ar,ap);if(aq.number==0&&!aq.isMine&&!aq.flagged){F(ar,ap)}if(--H==0){P()}k=false}function F(ay,aq){var ap=(ay==0)?0:ay-1;var ax=(ay==ah-1)?ah-1:ay+1;var av=(aq==0)?0:aq-1;var ar=(aq==ag-1)?ag-1:aq+1;for(var au=ap;au<=ax;au++){for(var at=av;at<=ar;at++){var aw=R[au][at];if(aw.number>0||(!aw.isMine&&!aw.flagged)){K(au,at)}}}}function M(aq,ap){R[aq][ap].isMine=true}function s(aq,ap){var at=R[aq][ap];if(!at.isMine){return}at.exploded=true;R[aq][ap]=at;if(Q){document.getElementById("snd_explode").play()}ak();for(var aq=0;aq<ah;aq++){for(var ap=0;ap<ag;ap++){var ar=R[aq][ap];var au=false;if(!ar.flagged&&ar.isMine){au=true}else{if(!ar.isMine&&ar.flagged){au=true;ar.number=0}}if(au){ar.triggered=true;R[aq][ap]=ar;X(aq,ap)}}}$(".smiley-icon").addClass("dead")}function aj(aq,ap){return R[aq][ap].triggered}function c(aq,ap){var ar=R[aq][ap];return !ar.triggered&&!ar.marked&&!ar.flagged}function an(aq,ap){return R[aq][ap].number!=0}function e(aq,ap){return R[aq][ap].marked}function z(aq,ap){return R[aq][ap].flagged}function j(aq,ap){return R[aq][ap].isMine}function G(aq,ap){return R[aq][ap].number}function X(aq,ap){var at=$('.ms-panel[data-coord="'+aq+","+ap+'"]');var ar=R[aq][ap];at.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(ar.triggered){at.addClass("triggered");if(ar.number>0){at.addClass("m"+ar.number)}if(ar.isMine){at.addClass("mine")}if(ar.exploded){at.addClass("exploded")}if(!ar.isMine&&ar.flagged){at.addClass("bogus")}}else{if(ar.flagged){at.addClass("flagged")}if(ar.marked){at.addClass("marked")}}}function r(){ad();J=setInterval(function(){ad()},1000)}function i(){clearInterval(J)}function ad(){if(Z<999){Z++;am("time",Z);if(Q){document.getElementById("snd_tick").play()}}}function ao(){if(L<ab){L++;am("mines",L)}}function u(){if(L>-99){L--;am("mines",(L>-100)?L:-99)}}function am(at,ar){at=".num-box#"+at;num=Math.abs(ar);var aq=Math.floor(num/100);num-=aq*100;var ap=Math.floor(num/10);num-=ap*10;if(ar<0){aq="n"}$(at+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(at+" .digit.iii").addClass("d"+aq);$(at+" .digit.ii").addClass("d"+ap);$(at+" .digit.i").addClass("d"+num)}function m(ay){ak();C=true;D=false;k=true;if(ay<0||ay>3||(ay==3&&!d)){ay=0}var at={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(ay!=3){var ar=at.width[ay];var aB=at.height[ay];var az=at.mines[ay]}else{var ar=ai;var aB=n;var az=p}ab=az;L=az;ag=ar;ah=aB;l=ay;x=false;Z=0;R=[];H=(ar*aB)-az;if(ae){ae=false;var aw=f("SWEEP_TOP");try{if(aw!==""){O=$.parseJSON(aw)}}catch(av){console.log("Error: leaderboard data is corrupt. Resetting to default...");o("SWEEP_TOP",O,365)}var aA=f("SWEEP_SND");if(aA!==""){A(aA,true)}var aq=f("SWEEP_MRK");if(aq!==""){E(aq,true)}var ax=f("SWEEP_LVL");var ap=f("SWEEP_WIDTH");var au=f("SWEEP_HEIGHT");var aC=f("SWEEP_MINES");if(ax!==""){if(ax!=3||(ap!==""&&au!==""&&aC!=="")){if(ax==3){v(ap,au,aC,true)}q(ax,true);return}}}B();am("time",Z);am("mines",L);$(".smiley-icon").removeClass("active cool dead");y();g.showWindow($("#ms-main"))}function B(){var at="";for(var ar=0;ar<ah;ar++){R.push([]);at+="<div class='ms-row'>";for(var aq=0;aq<ag;aq++){R[ar].push(new a());at+="<div class='ms-panel' data-coord='"+ar+","+aq+"'></div>"}at+="</div>"}var ap=ab;while(ap--){t()}$(".ms-grid").html(at)}function t(aq,at){var av=typeof aq!="undefined";var au=-1;var ap=-1;var ar=null;do{au=w(0,ah-1);ap=w(0,ag-1);ar=R[au][ap]}while(ar.isMine||(av&&au==aq&&ap==at));R[au][ap].number=0;M(au,ap);ac(au,ap)}function ac(aw,at,aq){var av=b(aw,at);var ap=0;for(var au=av[0][0];au<=av[0][1];au++){for(var ar=av[1][0];ar<=av[1][1];ar++){if(j(au,ar)){ap++;continue}if((aw==au&&at==ar)){continue}if(!aq){R[au][ar].number++}else{R[au][ar].number--}}}if(aq){R[aw][at].number=ap}}function w(aq,ap){return Math.floor(Math.random()*(ap+1-aq))+aq}function b(au,ar){var at=(au==0)?0:au-1;var av=(au==ah-1)?ah-1:au+1;var ap=(ar==0)?0:ar-1;var aq=(ar==ag-1)?ag-1:ar+1;return[[at,av],[ap,aq]]}function I(){return !C&&!D}function T(){if(C){C=false;D=false;r()}}function ak(){D=true;i()}function P(){$(".smiley-icon").addClass("cool");if(Q){document.getElementById("snd_win").play()}if(l<3&&l>=0){if(O[l][1]<Z){O[l][1]=Z;o("SWEEP_TOP",JSON.stringify(O),365)}}ak()}function o(aq,au,at){at*=86400000;var ar=new Date(Date.now()+at);var ap="expires="+ar.toUTCString();document.cookie=aq+"="+au+"; "+ap}function f(aq){aq=aq+"=";var ap=document.cookie.split(";");for(var at=0;at<ap.length;at++){var ar=ap[at];while(ar.charAt(0)==" "){ar=ar.substring(1)}if(ar.indexOf(aq)==0){return ar.substring(aq.length,ar.length)}}return""}})();