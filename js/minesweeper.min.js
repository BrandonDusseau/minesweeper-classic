(function(){if(typeof window.SweeperOSEnvironment=="undefined"){console.log("Sweeper OS envrionment is unavailable. Minesweeper cannot run.");return}var g=window.SweeperOSEnvironment;var J=null;var Y=0;var C=true;var k=true;var D=false;var x=false;var L=0;var aa=0;var l=0;var af=0;var ag=0;var R=null;var H=0;var ae=false;var V=false;var U=true;var Q=false;var d=false;var ah=9;var n=9;var p=10;var ad=true;var O=[["Anonymous",999],["Anonymous",999],["Anonymous",999]];function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){$("body").on("mouseup",function(an){$(".smiley-icon").removeClass("active");ae=false;V=false;$(".ms-panel.down").removeClass("down")});$("body").on("keydown",function(an){if($(".window#ms-main").hasClass("focused")){if(an.which==113){an.preventDefault();m(l)}else{if(an.which==112){an.preventDefault()}}}});$(".minesweeper").off("mousedown").on("mousedown",function(an){if(!D&&(an.which==1||an.which==2)){$(".smiley-icon").addClass("active")}});$(".smiley-btn").off("click").on("click",function(an){m(l)});$("#game_new").on("click",function(an){m(l)});$("#game_beg:not(.disabled)").on("click",function(an){q(0)});$("#game_int:not(.disabled)").on("click",function(an){q(1)});$("#game_exp:not(.disabled)").on("click",function(an){q(2)});$("#game_cst:not(.disabled)").on("click",function(ao){var an=$(".minesweeper").offset();$("#ms-custom-board #cst-height").val(n);$("#ms-custom-board #cst-width").val(ah);$("#ms-custom-board #cst-mines").val(p);g.showWindow($("#ms-custom-board"),an.left,an.top,$("#ms-main"))});$("#game_mrk:not(.disabled)").on("click",function(an){E(!U)});$("#game_snd:not(.disabled)").on("click",function(an){A(!Q)});m(0)});function A(ao,an){if(ao==true){Q=true;$("#game_snd").addClass("checked")}else{Q=false;$("#game_snd").removeClass("checked")}if(!an){o("SWEEP_SND",Q?1:0,365)}}function E(ao,an){if(ao==true){U=true;$("#game_mrk").addClass("checked")}else{U=false;$("#game_mrk").removeClass("checked")}if(!an){o("SWEEP_MRK",U?1:0,365)}}function q(ar,an){if(ar<0||ar>3){return}var ao=["beg","int","exp","cst"];for(var aq=0;aq<ao.length;aq++){var ap=$("#game_"+ao[aq]);if(aq==ar){ap.addClass("checked")}else{ap.removeClass("checked")}}if(!an){o("SWEEP_LVL",ar,365)}m(ar)}function v(aq,an,ar,ap){aq=(aq>30?30:aq);aq=(aq<9?9:aq);an=(an>24?24:an);an=(an<9?9:an);ar=(ar<10?10:ar);var ao=(an-1)*(aq-1);ar=(ar>ao?ao:ar);d=true;ah=aq;n=an;p=ar;if(!ap){o("SWEEP_WIDTH",aq,365);o("SWEEP_HEIGHT",an,365);o("SWEEP_MINES",ar,365)}}function y(){$(".window *").off("contextmenu").on("contextmenu",function(an){an.preventDefault()});$(".ms-panel").off("mousedown").on("mousedown",function(ao){if(!D){switch(ao.which){case 1:ae=true;$(this).trigger("mouseenter");break;case 2:V=true;$(this).trigger("mouseenter");break;case 3:var an=$(this);Z(an,ao);break}}});$(".ms-panel").off("mouseenter").on("mouseenter",function(ar){if(ae&&!$(this).hasClass("flagged")){$(this).addClass("down")}else{if(V){var aq=X($(this));var ap=b(aq[0],aq[1]);for(var ao=ap[0][0];ao<=ap[0][1];ao++){for(var an=ap[1][0];an<=ap[1][1];an++){if(!z(ao,an)){$('.ms-panel[data-coord="'+ao+","+an+'"]').addClass("down")}}}}}});$(".ms-panel").off("mouseleave").on("mouseleave",function(an){if((ae||V)&&(an.which==1||an.which==2)){$(".ms-panel.down").removeClass("down")}});$(".ms-panel").off("mouseup").on("mouseup",function(ao){if((ae||V)&&!D){if(C){T()}var an=$(this);Z(an,ao)}})}function Z(ax,ay){if(!ax.length||!ax.hasClass("ms-panel")){return}var av=X(ax);var aA=av[0];var ao=av[1];if(ay.which==1){$(".smiley-icon").removeClass("active");ae=false;if(!D){if(!ai(aA,ao)){K(aA,ao)}}}if(ay.which==2&&al(aA,ao)&&ai(aA,ao)){var an=b(aA,ao);var ap=[];var aw=G(aA,ao);for(var at=an[0][0];at<=an[0][1];at++){for(var ar=an[1][0];ar<=an[1][1];ar++){if(at==aA&&ar==ao){continue}if(z(at,ar)){aw--}else{ap.push([at,ar])}}}if(aw!==0){return}var aq=ap.length;for(var at=0;at<aq;at++){var au=ap[at][0];var az=ap[at][1];if(j(au,az)){ap.splice(at,1);ap.push([au,az]);aq--;at--}}for(var at=0;at<ap.length;at++){var au=ap[at][0];var az=ap[at][1];K(au,az)}}else{if(ay.which==3){if(!D&&!ai(aA,ao)){if(!z(aA,ao)&&!e(aA,ao)){N(aA,ao);u()}else{if(U&&z(aA,ao)){h(aA,ao);am()}else{if(!U){am()}S(aA,ao)}}}}}}function X(ao){var an=ao.data("coord").split(",");return[parseInt(an[0],10),parseInt(an[1],10)]}function N(ap,an){var ao=R[ap][an];if(!D&&!ao.triggered&&!ao.marked){R[ap][an].flagged=true}W(ap,an)}function h(ap,an){var ao=R[ap][an];if(!D&&!ao.triggered&&ao.flagged){ao.flagged=false;ao.marked=true}R[ap][an]=ao;W(ap,an)}function S(ap,an){var ao=R[ap][an];if(!D&&!ao.triggered){ao.marked=false;ao.flagged=false}R[ap][an]=ao;W(ap,an)}function K(ap,an){var ao=R[ap][an];if(D||ao.triggered||ao.flagged){return}ao.triggered=true;R[ap][an]=ao;if(!k&&ao.isMine){s(ap,an);return}else{if(k&&ao.isMine){R[ap][an].isMine=false;ab(ap,an,true);t(ap,an)}}W(ap,an);if(ao.number==0&&!ao.isMine&&!ao.flagged){F(ap,an)}if(--H==0){P()}k=false}function F(aw,ao){var an=(aw==0)?0:aw-1;var av=(aw==ag-1)?ag-1:aw+1;var at=(ao==0)?0:ao-1;var ap=(ao==af-1)?af-1:ao+1;for(var ar=an;ar<=av;ar++){for(var aq=at;aq<=ap;aq++){var au=R[ar][aq];if(au.number>0||(!au.isMine&&!au.flagged)){K(ar,aq)}}}}function M(ao,an){R[ao][an].isMine=true}function s(ao,an){var aq=R[ao][an];if(!aq.isMine){return}aq.exploded=true;R[ao][an]=aq;if(Q){document.getElementById("snd_explode").play()}aj();for(var ao=0;ao<ag;ao++){for(var an=0;an<af;an++){var ap=R[ao][an];var ar=false;if(!ap.flagged&&ap.isMine){ar=true}else{if(!ap.isMine&&ap.flagged){ar=true;ap.number=0}}if(ar){ap.triggered=true;R[ao][an]=ap;W(ao,an)}}}$(".smiley-icon").addClass("dead")}function ai(ao,an){return R[ao][an].triggered}function c(ao,an){var ap=R[ao][an];return !ap.triggered&&!ap.marked&&!ap.flagged}function al(ao,an){return R[ao][an].number!=0}function e(ao,an){return R[ao][an].marked}function z(ao,an){return R[ao][an].flagged}function j(ao,an){return R[ao][an].isMine}function G(ao,an){return R[ao][an].number}function W(ao,an){var aq=$('.ms-panel[data-coord="'+ao+","+an+'"]');var ap=R[ao][an];aq.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(ap.triggered){aq.addClass("triggered");if(ap.number>0){aq.addClass("m"+ap.number)}if(ap.isMine){aq.addClass("mine")}if(ap.exploded){aq.addClass("exploded")}if(!ap.isMine&&ap.flagged){aq.addClass("bogus")}}else{if(ap.flagged){aq.addClass("flagged")}if(ap.marked){aq.addClass("marked")}}}function r(){ac();J=setInterval(function(){ac()},1000)}function i(){clearInterval(J)}function ac(){if(Y<999){Y++;ak("time",Y);if(Q){document.getElementById("snd_tick").play()}}}function am(){if(L<aa){L++;ak("mines",L)}}function u(){if(L>-99){L--;ak("mines",(L>-100)?L:-99)}}function ak(aq,ap){aq=".num-box#"+aq;num=Math.abs(ap);var ao=Math.floor(num/100);num-=ao*100;var an=Math.floor(num/10);num-=an*10;if(ap<0){ao="n"}$(aq+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(aq+" .digit.iii").addClass("d"+ao);$(aq+" .digit.ii").addClass("d"+an);$(aq+" .digit.i").addClass("d"+num)}function m(aw){aj();C=true;D=false;k=true;if(aw<0||aw>3||(aw==3&&!d)){aw=0}var aq={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(aw!=3){var ap=aq.width[aw];var az=aq.height[aw];var ax=aq.mines[aw]}else{var ap=ah;var az=n;var ax=p}aa=ax;L=ax;af=ap;ag=az;l=aw;x=false;Y=0;R=[];H=(ap*az)-ax;if(ad){ad=false;var au=f("SWEEP_TOP");try{if(au!==""){O=$.parseJSON(au)}}catch(at){console.log("Error: leaderboard data is corrupt. Resetting to default...");o("SWEEP_TOP",O,365)}var ay=f("SWEEP_SND");if(ay!==""){A(ay,true)}var ao=f("SWEEP_MRK");if(ao!==""){E(ao,true)}var av=f("SWEEP_LVL");var an=f("SWEEP_WIDTH");var ar=f("SWEEP_HEIGHT");var aA=f("SWEEP_MINES");if(av!==""){if(av!=3||(an!==""&&ar!==""&&aA!=="")){if(av==3){v(an,ar,aA,true)}q(av,true);return}}}B();ak("time",Y);ak("mines",L);$(".smiley-icon").removeClass("active cool dead");y();g.showWindow($("#ms-main"))}function B(){var aq="";for(var ap=0;ap<ag;ap++){R.push([]);aq+="<div class='ms-row'>";for(var ao=0;ao<af;ao++){R[ap].push(new a());aq+="<div class='ms-panel' data-coord='"+ap+","+ao+"'></div>"}aq+="</div>"}var an=aa;while(an--){t()}$(".ms-grid").html(aq)}function t(ao,aq){var at=typeof ao!="undefined";var ar=-1;var an=-1;var ap=null;do{ar=w(0,ag-1);an=w(0,af-1);ap=R[ar][an]}while(ap.isMine||(at&&ar==ao&&an==aq));R[ar][an].number=0;M(ar,an);ab(ar,an)}function ab(au,aq,ao){var at=b(au,aq);var an=0;for(var ar=at[0][0];ar<=at[0][1];ar++){for(var ap=at[1][0];ap<=at[1][1];ap++){if(j(ar,ap)){an++;continue}if((au==ar&&aq==ap)){continue}if(!ao){R[ar][ap].number++}else{R[ar][ap].number--}}}if(ao){R[au][aq].number=an}}function w(ao,an){return Math.floor(Math.random()*(an+1-ao))+ao}function b(ar,ap){var aq=(ar==0)?0:ar-1;var at=(ar==ag-1)?ag-1:ar+1;var an=(ap==0)?0:ap-1;var ao=(ap==af-1)?af-1:ap+1;return[[aq,at],[an,ao]]}function I(){return !C&&!D}function T(){if(C){C=false;D=false;r()}}function aj(){D=true;i()}function P(){$(".smiley-icon").addClass("cool");if(Q){document.getElementById("snd_win").play()}if(l<3&&l>=0){if(O[l][1]<Y){O[l][1]=Y;o("SWEEP_TOP",JSON.stringify(O),365)}}aj()}function o(ao,ar,aq){aq*=86400000;var ap=new Date(Date.now()+aq);var an="expires="+ap.toUTCString();document.cookie=ao+"="+ar+"; "+an}function f(ao){ao=ao+"=";var an=document.cookie.split(";");for(var aq=0;aq<an.length;aq++){var ap=an[aq];while(ap.charAt(0)==" "){ap=ap.substring(1)}if(ap.indexOf(ao)==0){return ap.substring(ao.length,ap.length)}}return""}})();