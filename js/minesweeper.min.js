(function(){var x=null;var I=0;var s=true;var t=false;var n=false;var y=0;var K=0;var g=0;var N=0;var O=0;var D=null;var v=0;var q=0;function a(){this.number=0;this.isMine=false;this.flagged=false;this.marked=false;this.triggered=false;this.exploded=false}$(document).ready(function(){h(0)});function o(){$(".window *").off("contextmenu").on("contextmenu",function(U){U.preventDefault();var T=$(this);J(T,U)});$(".ms-panel").off("mousedown").on("mousedown",function(T){if(T.which==1&&!t&&!$(this).hasClass("triggered")&&!$(this).hasClass("flagged")){$(this).addClass("down");$(".smiley-icon").addClass("active")}});$(".ms-panel").off("mouseup").on("mouseup",function(T){if(T.which==1&&!$(this).hasClass("triggered")){$(this).removeClass("down");if(!t){$(".smiley-icon").removeClass("active")}}});$(".ms-panel").off("click").on("click",function(U){var T=$(this);J(T,U)});$("#menu-game").off("click").on("click",function(T){h(++q%3)});$(".smiley-btn").off("click").on("click",function(T){h(g)})}function J(V,U){U.stopPropagation();if(!V.length||!V.hasClass("ms-panel")){return}var X=H(V);var W=X[0];var T=X[1];if(U.which==1){if(!t&&!P(W,T)){z(W,T)}}else{if(U.which==3){if(!t&&!P(W,T)){if(!p(W,T)&&!c(W,T)){A(W,T);l()}else{if(p(W,T)){d(W,T);S()}else{E(W,T)}}}}}}function H(U){var T=U.data("coord").split(",");return[parseInt(T[0],10),parseInt(T[1],10)]}function A(V,T){var U=D[V][T];if(!t&&!U.triggered&&!U.marked){D[V][T].flagged=true}G(V,T)}function d(V,T){var U=D[V][T];if(!t&&!U.triggered&&U.flagged){U.flagged=false;U.marked=true}D[V][T]=U;G(V,T)}function E(V,T){var U=D[V][T];if(!t&&!U.triggered){U.marked=false;U.flagged=false}D[V][T]=U;G(V,T)}function z(V,T){var U=D[V][T];if(t||U.triggered||U.flagged){return}U.triggered=true;if(s){F()}D[V][T]=U;if(!s&&U.isMine){j(V,T);return}else{if(s&&U.isMine){D[V][T].isMine=false;L(V,T,true);k(V,T)}}G(V,T);s=false;if(U.number==0&&!U.isMine&&!U.flagged){u(V,T)}if(--v==0){C()}}function u(ab,U){var T=(ab==0)?0:ab-1;var aa=(ab==O-1)?O-1:ab+1;var Y=(U==0)?0:U-1;var V=(U==N-1)?N-1:U+1;for(var X=T;X<=aa;X++){for(var W=Y;W<=V;W++){var Z=D[X][W];if(Z.number>0||(!Z.isMine&&!Z.flagged)){z(X,W)}}}}function B(U,T){D[U][T].isMine=true}function j(U,T){var W=D[U][T];if(!W.isMine){return}W.exploded=true;D[U][T]=W;Q();for(var U=0;U<O;U++){for(var T=0;T<N;T++){var V=D[U][T];var X=false;if(!V.flagged&&V.isMine){X=true}else{if(!V.isMine&&V.flagged){X=true;V.number=0}}if(X){V.triggered=true;D[U][T]=V;G(U,T)}}}$(".smiley-icon").addClass("dead")}function P(U,T){return D[U][T].triggered}function b(U,T){var V=D[U][T];return !V.triggered&&!V.marked&&!V.flagged}function c(U,T){return D[U][T].marked}function p(U,T){return D[U][T].flagged}function f(U,T){return D[U][T].isMine}function G(U,T){var W=$('.ms-panel[data-coord="'+U+","+T+'"]');var V=D[U][T];W.removeClass("triggered mine exploded m1 m2 m3 m4 m5 m6 m7 m8 flagged marked");if(V.triggered){W.addClass("triggered");if(V.number>0){W.addClass("m"+V.number)}if(V.isMine){W.addClass("mine")}if(V.exploded){W.addClass("exploded")}if(!V.isMine&&V.flagged){W.addClass("bogus")}}else{if(V.flagged){W.addClass("flagged")}if(V.marked){W.addClass("marked")}}}function i(){I=1;R("time",I);x=setInterval(function(){M()},1000)}function e(){clearInterval(x)}function M(){if(I<999){I++;R("time",I)}}function S(){if(y<K){y++;R("mines",y)}}function l(){if(y>-99){y--;R("mines",(y>-100)?y:-99)}}function R(W,V){W=".num-box#"+W;num=Math.abs(V);var U=Math.floor(num/100);num-=U*100;var T=Math.floor(num/10);num-=T*10;if(V<0){U="n"}$(W+" .digit").removeClass("d0 d1 d2 d3 d4 d5 d6 d7 d8 d9 dn");$(W+" .digit.iii").addClass("d"+U);$(W+" .digit.ii").addClass("d"+T);$(W+" .digit.i").addClass("d"+num)}function h(X,U,T,V){Q();s=true;t=false;var W={width:[9,16,30],height:[9,16,16],mines:[10,40,99]};if(X>=0||X<=2){U=W.width[X];T=W.height[X];V=W.mines[X]}K=V;y=V;N=U;O=T;g=X;n=false;I=0;D=[];v=(U*T)-V;r();R("time",I);R("mines",y);$(".smiley-icon").removeClass("active cool dead");o();$(".window#ms-main").css("display","inline-block")}function r(){var W="";for(var V=0;V<O;V++){D.push([]);W+="<div class='ms-row'>";for(var U=0;U<N;U++){D[V].push(new a());W+="<div class='ms-panel' data-coord='"+V+","+U+"'></div>"}W+="</div>"}var T=K;while(T--){k()}$(".ms-grid").html(W)}function k(U,W){var Y=typeof U!="undefined";var X=-1;var T=-1;var V=null;do{X=m(0,O-1);T=m(0,N-1);V=D[X][T]}while(V.isMine||(Y&&X==U&&T==W));D[X][T].number=0;B(X,T);L(X,T)}function L(ac,V,aa){var U=(ac==0)?0:ac-1;var ab=(ac==O-1)?O-1:ac+1;var Z=(V==0)?0:V-1;var W=(V==N-1)?N-1:V+1;var T=0;for(var Y=U;Y<=ab;Y++){for(var X=Z;X<=W;X++){if(f(Y,X)){T++;continue}if((ac==Y&&V==X)){continue}if(!aa){D[Y][X].number++}else{D[Y][X].number--}}}if(aa){D[ac][V].number=T}}function m(U,T){return Math.floor(Math.random()*(T+1-U))+U}function w(){return !s&&!t}function F(){if(s){t=false;i()}}function Q(){if(w()){t=true;e()}}function C(){$(".smiley-icon").addClass("cool");Q()}})();